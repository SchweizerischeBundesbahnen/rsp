---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.4.1
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
# %autosave 0
# %matplotlib inline
```

```{python}
import pandas as pd
import plotly.graph_objects as go

from rsp.utils.analysis_tools import notebook_plot_weg_zeit_diagramm_2d
from rsp.utils.data_types import convert_list_of_experiment_results_analysis_to_data_frame
from rsp.utils.experiments import EXPERIMENT_DATA_SUBDIRECTORY_NAME
from rsp.utils.experiments import load_and_expand_experiment_results_from_data_folder
```

```{python}
experiment_base_directory = './rsp/exp_hypothesis_one_2020_03_17T07_01_49/'
experiments_of_interest = None
```

```{python}
experiment_data_directory = f'{experiment_base_directory}/{EXPERIMENT_DATA_SUBDIRECTORY_NAME}'
experiment_results_list = load_and_expand_experiment_results_from_data_folder(experiment_data_folder_name=experiment_data_directory,experiment_ids=experiments_of_interest)
experiment_data: pd.DataFrame = convert_list_of_experiment_results_analysis_to_data_frame(experiment_results_list)
#experiment_data = experiment_data.drop(['experiment_parameters','problem_full','problem_full_after_malfunction','problem_delta_after_malfunction','results_full','results_full_after_malfunction','results_delta_after_malfunction'],axis=1)
```

```{python}
axis_of_interest = 'n_agents'
columns_of_interest = ['time_full','time_full_after_malfunction','time_delta_after_malfunction']
```

### Visualize Compuational time comparison

```{python}
fig = go.Figure()
for column in columns_of_interest:
    fig.add_trace(go.Box(x=experiment_data.n_agents,
                         y=experiment_data[column],
                         name=column,pointpos=-1,
                         boxpoints='all',
                         hovertext=experiment_data['experiment_id'],
                         hovertemplate='<b>Time</b>: %{y:.2f}s'+
                         '<br><b>Nr. Agents</b>: %{x}<br>'+
                         '<b>Experiment id:</b>%{hovertext}',
                         marker=dict(size=3)))
fig.update_layout(boxmode='group')
fig.update_layout(title_text="Computational Times")
fig.update_xaxes(title="Agents[#]")
fig.update_yaxes(title="Time[s]")
fig.show()
```

### Visualize Speed Up facotrs for experiments

```{python}
fig = go.Figure()

fig.add_trace(go.Box(x=experiment_data.n_agents, y=experiment_data['speed_up'],pointpos=-1,boxpoints=False, marker=dict(size=3)))
fig.add_trace(go.Scatter(x=experiment_data.n_agents+0.4,
                         y=experiment_data['speed_up'],
                         mode='markers',
                         marker=dict(size=5,color=experiment_data['size']),
                         hovertext=experiment_data['experiment_id'],
                         hovertemplate='<b>Speedup Factor </b>: %{y:.2f}'+
                         '<br><b>Nr. Agents</b>: %{x:.0f}<br>'+
                         '<b>Experiment id:</b>%{hovertext}'
                         ))

fig.update_layout(boxmode='group')
fig.update_layout(title_text="Speed Up Factors")
fig.update_xaxes(title="Agents[#]")
fig.update_yaxes(title="Speed Up Factor")
fig.show()
```

### Visualize Weg-Zeit-Diagram of specific experiment

```{python}
experiment_of_interest = 269
```

```{python}
schedule, reschedule, difference, ranges = notebook_plot_weg_zeit_diagramm_2d(experiment_data_frame=experiment_data,experiment_id = experiment_of_interest)
```

```{python}
fig = go.Figure()
for idx, line in enumerate(schedule):
    x,y = zip(*line)
    fig.add_trace(go.Scatter(x=x,
                             y=y,
                             mode='lines+markers',
                              marker=dict(size=2),
                             name="Agent {}".format(idx)
                            ))
fig.update_layout(title_text="Original Schedule")
fig.update_yaxes(autorange="reversed")
fig.update_xaxes(title="Sorted Ressources")
fig.update_yaxes(title="Time")
fig.update_xaxes(range=[0,ranges[0]])
fig.update_yaxes(range=[0,ranges[1]])

fig.show()

fig1 = go.Figure()
for idx, line in enumerate(reschedule):
    x,y = zip(*line)
    fig1.add_trace(go.Scatter(x=x,
                             y=y,
                             mode='lines+markers',
                              marker=dict(size=2),
                              name="Agent {}".format(idx)
                            ))
fig1.update_layout(title_text="reschedule")
fig1.update_yaxes(autorange="reversed")
fig1.update_xaxes(title="Sorted Ressources")
fig1.update_yaxes(title="Time")
fig1.update_xaxes(range=[0,ranges[0]])
fig1.update_yaxes(range=[0,ranges[1]])
fig1.show()

fig2 = go.Figure()
for idx, line in enumerate(difference):
    x,y = zip(*line)
    fig2.add_trace(go.Scatter(x=x,
                             y=y,
                             mode='lines+markers',
                              marker=dict(size=2),
                              name="Agent {}".format(idx)
                            ))
fig2.update_layout(title_text="Difference")
fig2.update_yaxes(autorange="reversed")
fig2.update_xaxes(title="Sorted Ressources")
fig2.update_yaxes(title="Time")
fig2.update_xaxes(range=[0,ranges[0]])
fig2.update_yaxes(range=[0,ranges[1]])
fig2.show()
```

### Visualize Route-DAG for specific agent

```{python}

```
