import pprint
from collections import OrderedDict
from typing import Any
from typing import Dict

from flatland.envs.rail_trainrun_data_structures import TrainrunWaypoint
from flatland.envs.rail_trainrun_data_structures import Waypoint

from rsp.schedule_problem_description.data_types_and_utils import _get_topology_from_agents_path_dict
from rsp.schedule_problem_description.data_types_and_utils import route_dag_constraints_dict_from_list_of_train_run_waypoint
from rsp.schedule_problem_description.data_types_and_utils import ScheduleProblemDescription
from rsp.schedule_problem_description.data_types_and_utils import topo_from_agent_paths
from rsp.schedule_problem_description.route_dag_constraints.scoper_zero import delta_zero_for_all_agents
from rsp.schedule_problem_description.route_dag_constraints.scoper_zero import scoper_zero_running
from rsp.utils.data_types import experiment_freeze_dict_pretty_print
from rsp.utils.data_types import experiment_freeze_pretty_print
from rsp.utils.data_types import ExperimentMalfunction
from rsp.utils.data_types import RouteDAGConstraints
from rsp.utils.data_types import RouteDAGConstraintsDict

_pp = pprint.PrettyPrinter(indent=4)


def _get_data():
    train_run = [
        TrainrunWaypoint(scheduled_at=1, waypoint=Waypoint(position=(6, 23), direction=3)),
        TrainrunWaypoint(scheduled_at=2, waypoint=Waypoint(position=(6, 22), direction=3)),
        TrainrunWaypoint(scheduled_at=3, waypoint=Waypoint(position=(6, 21), direction=3)),
        TrainrunWaypoint(scheduled_at=4, waypoint=Waypoint(position=(7, 21), direction=2)),
        TrainrunWaypoint(scheduled_at=5, waypoint=Waypoint(position=(7, 20), direction=3)),
        TrainrunWaypoint(scheduled_at=6, waypoint=Waypoint(position=(8, 20), direction=2)),
        TrainrunWaypoint(scheduled_at=7, waypoint=Waypoint(position=(8, 19), direction=3)),
        TrainrunWaypoint(scheduled_at=8, waypoint=Waypoint(position=(8, 18), direction=3)),
        TrainrunWaypoint(scheduled_at=9, waypoint=Waypoint(position=(8, 17), direction=3)),
        TrainrunWaypoint(scheduled_at=10, waypoint=Waypoint(position=(8, 16), direction=3)),
        TrainrunWaypoint(scheduled_at=11, waypoint=Waypoint(position=(8, 15), direction=3)),
        TrainrunWaypoint(scheduled_at=12, waypoint=Waypoint(position=(8, 14), direction=3)),
        TrainrunWaypoint(scheduled_at=13, waypoint=Waypoint(position=(8, 13), direction=3)),
        TrainrunWaypoint(scheduled_at=14, waypoint=Waypoint(position=(8, 12), direction=3)),
        TrainrunWaypoint(scheduled_at=15, waypoint=Waypoint(position=(8, 11), direction=3)),
        TrainrunWaypoint(scheduled_at=16, waypoint=Waypoint(position=(8, 10), direction=3)),
        TrainrunWaypoint(scheduled_at=17, waypoint=Waypoint(position=(8, 9), direction=3)),
        TrainrunWaypoint(scheduled_at=18, waypoint=Waypoint(position=(8, 8), direction=3)),
        TrainrunWaypoint(scheduled_at=19, waypoint=Waypoint(position=(8, 7), direction=3)),
        TrainrunWaypoint(scheduled_at=20, waypoint=Waypoint(position=(8, 6), direction=3)),
        TrainrunWaypoint(scheduled_at=21, waypoint=Waypoint(position=(8, 5), direction=3)),
        TrainrunWaypoint(scheduled_at=22, waypoint=Waypoint(position=(8, 4), direction=3)),
        TrainrunWaypoint(scheduled_at=23, waypoint=Waypoint(position=(8, 3), direction=3)),
        TrainrunWaypoint(scheduled_at=24, waypoint=Waypoint(position=(8, 2), direction=3)),
        TrainrunWaypoint(scheduled_at=25, waypoint=Waypoint(position=(8, 1), direction=3)),
        TrainrunWaypoint(scheduled_at=26, waypoint=Waypoint(position=(9, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=27, waypoint=Waypoint(position=(10, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=28, waypoint=Waypoint(position=(11, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=29, waypoint=Waypoint(position=(12, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=30, waypoint=Waypoint(position=(13, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=31, waypoint=Waypoint(position=(14, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=32, waypoint=Waypoint(position=(15, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=33, waypoint=Waypoint(position=(16, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=34, waypoint=Waypoint(position=(17, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=35, waypoint=Waypoint(position=(18, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=36, waypoint=Waypoint(position=(19, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=37, waypoint=Waypoint(position=(20, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=38, waypoint=Waypoint(position=(21, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=39, waypoint=Waypoint(position=(22, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=40, waypoint=Waypoint(position=(23, 1), direction=2)),
        TrainrunWaypoint(scheduled_at=41, waypoint=Waypoint(position=(23, 2), direction=1)),
        TrainrunWaypoint(scheduled_at=42, waypoint=Waypoint(position=(23, 3), direction=1)),
        TrainrunWaypoint(scheduled_at=43, waypoint=Waypoint(position=(23, 4), direction=1)),
        TrainrunWaypoint(scheduled_at=44, waypoint=Waypoint(position=(23, 5), direction=1)),
        TrainrunWaypoint(scheduled_at=45, waypoint=Waypoint(position=(23, 6), direction=1)),
        TrainrunWaypoint(scheduled_at=46, waypoint=Waypoint(position=(23, 7), direction=1)),
        TrainrunWaypoint(scheduled_at=47, waypoint=Waypoint(position=(23, 8), direction=1)),
        TrainrunWaypoint(scheduled_at=48, waypoint=Waypoint(position=(23, 9), direction=1)),
        TrainrunWaypoint(scheduled_at=49, waypoint=Waypoint(position=(23, 10), direction=1)),
        TrainrunWaypoint(scheduled_at=50, waypoint=Waypoint(position=(23, 11), direction=1)),
        TrainrunWaypoint(scheduled_at=51, waypoint=Waypoint(position=(23, 12), direction=1)),
        TrainrunWaypoint(scheduled_at=52, waypoint=Waypoint(position=(23, 13), direction=1)),
        TrainrunWaypoint(scheduled_at=53, waypoint=Waypoint(position=(23, 14), direction=1)),
        TrainrunWaypoint(scheduled_at=54, waypoint=Waypoint(position=(23, 15), direction=1)),
        TrainrunWaypoint(scheduled_at=55, waypoint=Waypoint(position=(23, 16), direction=1)),
        TrainrunWaypoint(scheduled_at=56, waypoint=Waypoint(position=(23, 17), direction=1)),
        TrainrunWaypoint(scheduled_at=57, waypoint=Waypoint(position=(23, 18), direction=1)),
        TrainrunWaypoint(scheduled_at=58, waypoint=Waypoint(position=(23, 19), direction=1)),
        TrainrunWaypoint(scheduled_at=59, waypoint=Waypoint(position=(24, 19), direction=2)),
        TrainrunWaypoint(scheduled_at=60, waypoint=Waypoint(position=(24, 20), direction=1)),
        TrainrunWaypoint(scheduled_at=61, waypoint=Waypoint(position=(24, 21), direction=1)),
        TrainrunWaypoint(scheduled_at=62, waypoint=Waypoint(position=(24, 22), direction=1)),
        TrainrunWaypoint(scheduled_at=63, waypoint=Waypoint(position=(24, 23), direction=1))]

    agent_paths = [(
        Waypoint(position=(6, 23), direction=3), Waypoint(position=(6, 22), direction=3),
        Waypoint(position=(6, 21), direction=3), Waypoint(position=(7, 21), direction=2),
        Waypoint(position=(7, 20), direction=3), Waypoint(position=(8, 20), direction=2),
        Waypoint(position=(8, 19), direction=3), Waypoint(position=(8, 18), direction=3),
        Waypoint(position=(8, 17), direction=3), Waypoint(position=(8, 16), direction=3),
        Waypoint(position=(8, 15), direction=3), Waypoint(position=(8, 14), direction=3),
        Waypoint(position=(8, 13), direction=3), Waypoint(position=(8, 12), direction=3),
        Waypoint(position=(8, 11), direction=3), Waypoint(position=(8, 10), direction=3),
        Waypoint(position=(8, 9), direction=3), Waypoint(position=(8, 8), direction=3),
        Waypoint(position=(8, 7), direction=3), Waypoint(position=(8, 6), direction=3),
        Waypoint(position=(8, 5), direction=3), Waypoint(position=(8, 4), direction=3),
        Waypoint(position=(8, 3), direction=3), Waypoint(position=(8, 2), direction=3),
        Waypoint(position=(8, 1), direction=3), Waypoint(position=(9, 1), direction=2),
        Waypoint(position=(10, 1), direction=2), Waypoint(position=(11, 1), direction=2),
        Waypoint(position=(12, 1), direction=2), Waypoint(position=(13, 1), direction=2),
        Waypoint(position=(14, 1), direction=2), Waypoint(position=(15, 1), direction=2),
        Waypoint(position=(16, 1), direction=2), Waypoint(position=(17, 1), direction=2),
        Waypoint(position=(18, 1), direction=2), Waypoint(position=(19, 1), direction=2),
        Waypoint(position=(20, 1), direction=2), Waypoint(position=(21, 1), direction=2),
        Waypoint(position=(22, 1), direction=2), Waypoint(position=(23, 1), direction=2),
        Waypoint(position=(23, 2), direction=1), Waypoint(position=(23, 3), direction=1),
        Waypoint(position=(23, 4), direction=1), Waypoint(position=(23, 5), direction=1),
        Waypoint(position=(23, 6), direction=1), Waypoint(position=(23, 7), direction=1),
        Waypoint(position=(23, 8), direction=1), Waypoint(position=(23, 9), direction=1),
        Waypoint(position=(23, 10), direction=1), Waypoint(position=(23, 11), direction=1),
        Waypoint(position=(23, 12), direction=1), Waypoint(position=(23, 13), direction=1),
        Waypoint(position=(23, 14), direction=1), Waypoint(position=(23, 15), direction=1),
        Waypoint(position=(23, 16), direction=1), Waypoint(position=(23, 17), direction=1),
        Waypoint(position=(23, 18), direction=1), Waypoint(position=(23, 19), direction=1),
        Waypoint(position=(24, 19), direction=2), Waypoint(position=(24, 20), direction=1),
        Waypoint(position=(24, 21), direction=1), Waypoint(position=(24, 22), direction=1),
        Waypoint(position=(24, 23), direction=1)),
        (
            Waypoint(position=(6, 23), direction=3), Waypoint(position=(6, 22), direction=3),
            Waypoint(position=(6, 21), direction=3), Waypoint(position=(7, 21), direction=2),
            Waypoint(position=(7, 20), direction=3), Waypoint(position=(8, 20), direction=2),
            Waypoint(position=(8, 19), direction=3), Waypoint(position=(8, 18), direction=3),
            Waypoint(position=(8, 17), direction=3), Waypoint(position=(8, 16), direction=3),
            Waypoint(position=(8, 15), direction=3), Waypoint(position=(8, 14), direction=3),
            Waypoint(position=(8, 13), direction=3), Waypoint(position=(8, 12), direction=3),
            Waypoint(position=(8, 11), direction=3), Waypoint(position=(8, 10), direction=3),
            Waypoint(position=(8, 9), direction=3), Waypoint(position=(8, 8), direction=3),
            Waypoint(position=(8, 7), direction=3), Waypoint(position=(8, 6), direction=3),
            Waypoint(position=(8, 5), direction=3), Waypoint(position=(8, 4), direction=3),
            Waypoint(position=(8, 3), direction=3), Waypoint(position=(8, 2), direction=3),
            Waypoint(position=(8, 1), direction=3), Waypoint(position=(9, 1), direction=2),
            Waypoint(position=(10, 1), direction=2), Waypoint(position=(11, 1), direction=2),
            Waypoint(position=(12, 1), direction=2), Waypoint(position=(13, 1), direction=2),
            Waypoint(position=(14, 1), direction=2), Waypoint(position=(15, 1), direction=2),
            Waypoint(position=(16, 1), direction=2), Waypoint(position=(17, 1), direction=2),
            Waypoint(position=(18, 1), direction=2), Waypoint(position=(19, 1), direction=2),
            Waypoint(position=(20, 1), direction=2), Waypoint(position=(21, 1), direction=2),
            Waypoint(position=(22, 1), direction=2), Waypoint(position=(23, 1), direction=2),
            Waypoint(position=(23, 2), direction=1), Waypoint(position=(23, 3), direction=1),
            Waypoint(position=(23, 4), direction=1), Waypoint(position=(23, 5), direction=1),
            Waypoint(position=(23, 6), direction=1), Waypoint(position=(23, 7), direction=1),
            Waypoint(position=(23, 8), direction=1), Waypoint(position=(23, 9), direction=1),
            Waypoint(position=(23, 10), direction=1), Waypoint(position=(24, 10), direction=2),
            Waypoint(position=(24, 11), direction=1), Waypoint(position=(24, 12), direction=1),
            Waypoint(position=(24, 13), direction=1), Waypoint(position=(24, 14), direction=1),
            Waypoint(position=(24, 15), direction=1), Waypoint(position=(24, 16), direction=1),
            Waypoint(position=(24, 17), direction=1), Waypoint(position=(24, 18), direction=1),
            Waypoint(position=(24, 19), direction=1), Waypoint(position=(24, 20), direction=1),
            Waypoint(position=(24, 21), direction=1), Waypoint(position=(24, 22), direction=1),
            Waypoint(position=(24, 23), direction=1)),
        (
            Waypoint(position=(6, 23), direction=3), Waypoint(position=(6, 22), direction=3),
            Waypoint(position=(6, 21), direction=3), Waypoint(position=(7, 21), direction=2),
            Waypoint(position=(7, 20), direction=3), Waypoint(position=(8, 20), direction=2),
            Waypoint(position=(8, 19), direction=3), Waypoint(position=(8, 18), direction=3),
            Waypoint(position=(8, 17), direction=3), Waypoint(position=(8, 16), direction=3),
            Waypoint(position=(8, 15), direction=3), Waypoint(position=(8, 14), direction=3),
            Waypoint(position=(8, 13), direction=3), Waypoint(position=(8, 12), direction=3),
            Waypoint(position=(8, 11), direction=3), Waypoint(position=(8, 10), direction=3),
            Waypoint(position=(8, 9), direction=3), Waypoint(position=(8, 8), direction=3),
            Waypoint(position=(8, 7), direction=3), Waypoint(position=(8, 6), direction=3),
            Waypoint(position=(8, 5), direction=3), Waypoint(position=(8, 4), direction=3),
            Waypoint(position=(8, 3), direction=3), Waypoint(position=(8, 2), direction=3),
            Waypoint(position=(8, 1), direction=3), Waypoint(position=(9, 1), direction=2),
            Waypoint(position=(10, 1), direction=2), Waypoint(position=(11, 1), direction=2),
            Waypoint(position=(12, 1), direction=2), Waypoint(position=(13, 1), direction=2),
            Waypoint(position=(14, 1), direction=2), Waypoint(position=(15, 1), direction=2),
            Waypoint(position=(16, 1), direction=2), Waypoint(position=(17, 1), direction=2),
            Waypoint(position=(18, 1), direction=2), Waypoint(position=(19, 1), direction=2),
            Waypoint(position=(20, 1), direction=2), Waypoint(position=(21, 1), direction=2),
            Waypoint(position=(22, 1), direction=2), Waypoint(position=(23, 1), direction=2),
            Waypoint(position=(23, 2), direction=1), Waypoint(position=(23, 3), direction=1),
            Waypoint(position=(24, 3), direction=2), Waypoint(position=(24, 4), direction=1),
            Waypoint(position=(24, 5), direction=1), Waypoint(position=(24, 6), direction=1),
            Waypoint(position=(24, 7), direction=1), Waypoint(position=(24, 8), direction=1),
            Waypoint(position=(24, 9), direction=1), Waypoint(position=(24, 10), direction=1),
            Waypoint(position=(24, 11), direction=1), Waypoint(position=(24, 12), direction=1),
            Waypoint(position=(24, 13), direction=1), Waypoint(position=(24, 14), direction=1),
            Waypoint(position=(24, 15), direction=1), Waypoint(position=(24, 16), direction=1),
            Waypoint(position=(24, 17), direction=1), Waypoint(position=(24, 18), direction=1),
            Waypoint(position=(24, 19), direction=1), Waypoint(position=(24, 20), direction=1),
            Waypoint(position=(24, 21), direction=1), Waypoint(position=(24, 22), direction=1),
            Waypoint(position=(24, 23), direction=1)),
        (
            Waypoint(position=(6, 23), direction=3), Waypoint(position=(6, 22), direction=3),
            Waypoint(position=(6, 21), direction=3), Waypoint(position=(7, 21), direction=2),
            Waypoint(position=(7, 20), direction=3), Waypoint(position=(8, 20), direction=2),
            Waypoint(position=(8, 19), direction=3), Waypoint(position=(8, 18), direction=3),
            Waypoint(position=(8, 17), direction=3), Waypoint(position=(8, 16), direction=3),
            Waypoint(position=(8, 15), direction=3), Waypoint(position=(8, 14), direction=3),
            Waypoint(position=(8, 13), direction=3), Waypoint(position=(8, 12), direction=3),
            Waypoint(position=(8, 11), direction=3), Waypoint(position=(8, 10), direction=3),
            Waypoint(position=(8, 9), direction=3), Waypoint(position=(8, 8), direction=3),
            Waypoint(position=(8, 7), direction=3), Waypoint(position=(8, 6), direction=3),
            Waypoint(position=(8, 5), direction=3), Waypoint(position=(8, 4), direction=3),
            Waypoint(position=(8, 3), direction=3), Waypoint(position=(8, 2), direction=3),
            Waypoint(position=(8, 1), direction=3), Waypoint(position=(9, 1), direction=2),
            Waypoint(position=(10, 1), direction=2), Waypoint(position=(11, 1), direction=2),
            Waypoint(position=(12, 1), direction=2), Waypoint(position=(13, 1), direction=2),
            Waypoint(position=(14, 1), direction=2), Waypoint(position=(15, 1), direction=2),
            Waypoint(position=(16, 1), direction=2), Waypoint(position=(17, 1), direction=2),
            Waypoint(position=(18, 1), direction=2), Waypoint(position=(19, 1), direction=2),
            Waypoint(position=(20, 1), direction=2), Waypoint(position=(21, 1), direction=2),
            Waypoint(position=(22, 1), direction=2), Waypoint(position=(23, 1), direction=2),
            Waypoint(position=(24, 1), direction=2), Waypoint(position=(24, 2), direction=1),
            Waypoint(position=(24, 3), direction=1), Waypoint(position=(24, 4), direction=1),
            Waypoint(position=(24, 5), direction=1), Waypoint(position=(24, 6), direction=1),
            Waypoint(position=(24, 7), direction=1), Waypoint(position=(24, 8), direction=1),
            Waypoint(position=(24, 9), direction=1), Waypoint(position=(24, 10), direction=1),
            Waypoint(position=(24, 11), direction=1), Waypoint(position=(24, 12), direction=1),
            Waypoint(position=(24, 13), direction=1), Waypoint(position=(24, 14), direction=1),
            Waypoint(position=(24, 15), direction=1), Waypoint(position=(24, 16), direction=1),
            Waypoint(position=(24, 17), direction=1), Waypoint(position=(24, 18), direction=1),
            Waypoint(position=(24, 19), direction=1), Waypoint(position=(24, 20), direction=1),
            Waypoint(position=(24, 21), direction=1), Waypoint(position=(24, 22), direction=1),
            Waypoint(position=(24, 23), direction=1)),
        (
            Waypoint(position=(6, 23), direction=3), Waypoint(position=(6, 22), direction=3),
            Waypoint(position=(6, 21), direction=3), Waypoint(position=(7, 21), direction=2),
            Waypoint(position=(7, 20), direction=3), Waypoint(position=(7, 19), direction=3),
            Waypoint(position=(7, 18), direction=3), Waypoint(position=(7, 17), direction=3),
            Waypoint(position=(7, 16), direction=3), Waypoint(position=(7, 15), direction=3),
            Waypoint(position=(7, 14), direction=3), Waypoint(position=(7, 13), direction=3),
            Waypoint(position=(7, 12), direction=3), Waypoint(position=(7, 11), direction=3),
            Waypoint(position=(8, 11), direction=2), Waypoint(position=(8, 10), direction=3),
            Waypoint(position=(8, 9), direction=3), Waypoint(position=(8, 8), direction=3),
            Waypoint(position=(8, 7), direction=3), Waypoint(position=(8, 6), direction=3),
            Waypoint(position=(8, 5), direction=3), Waypoint(position=(8, 4), direction=3),
            Waypoint(position=(8, 3), direction=3), Waypoint(position=(8, 2), direction=3),
            Waypoint(position=(8, 1), direction=3), Waypoint(position=(9, 1), direction=2),
            Waypoint(position=(10, 1), direction=2), Waypoint(position=(11, 1), direction=2),
            Waypoint(position=(12, 1), direction=2), Waypoint(position=(13, 1), direction=2),
            Waypoint(position=(14, 1), direction=2), Waypoint(position=(15, 1), direction=2),
            Waypoint(position=(16, 1), direction=2), Waypoint(position=(17, 1), direction=2),
            Waypoint(position=(18, 1), direction=2), Waypoint(position=(19, 1), direction=2),
            Waypoint(position=(20, 1), direction=2), Waypoint(position=(21, 1), direction=2),
            Waypoint(position=(22, 1), direction=2), Waypoint(position=(23, 1), direction=2),
            Waypoint(position=(23, 2), direction=1), Waypoint(position=(23, 3), direction=1),
            Waypoint(position=(23, 4), direction=1), Waypoint(position=(23, 5), direction=1),
            Waypoint(position=(23, 6), direction=1), Waypoint(position=(23, 7), direction=1),
            Waypoint(position=(23, 8), direction=1), Waypoint(position=(23, 9), direction=1),
            Waypoint(position=(23, 10), direction=1), Waypoint(position=(23, 11), direction=1),
            Waypoint(position=(23, 12), direction=1), Waypoint(position=(23, 13), direction=1),
            Waypoint(position=(23, 14), direction=1), Waypoint(position=(23, 15), direction=1),
            Waypoint(position=(23, 16), direction=1), Waypoint(position=(23, 17), direction=1),
            Waypoint(position=(23, 18), direction=1), Waypoint(position=(23, 19), direction=1),
            Waypoint(position=(24, 19), direction=2), Waypoint(position=(24, 20), direction=1),
            Waypoint(position=(24, 21), direction=1), Waypoint(position=(24, 22), direction=1),
            Waypoint(position=(24, 23), direction=1)),
        (
            Waypoint(position=(6, 23), direction=3), Waypoint(position=(6, 22), direction=3),
            Waypoint(position=(6, 21), direction=3), Waypoint(position=(7, 21), direction=2),
            Waypoint(position=(7, 20), direction=3), Waypoint(position=(7, 19), direction=3),
            Waypoint(position=(7, 18), direction=3), Waypoint(position=(7, 17), direction=3),
            Waypoint(position=(7, 16), direction=3), Waypoint(position=(7, 15), direction=3),
            Waypoint(position=(7, 14), direction=3), Waypoint(position=(7, 13), direction=3),
            Waypoint(position=(7, 12), direction=3), Waypoint(position=(7, 11), direction=3),
            Waypoint(position=(8, 11), direction=2), Waypoint(position=(8, 10), direction=3),
            Waypoint(position=(8, 9), direction=3), Waypoint(position=(8, 8), direction=3),
            Waypoint(position=(8, 7), direction=3), Waypoint(position=(8, 6), direction=3),
            Waypoint(position=(8, 5), direction=3), Waypoint(position=(8, 4), direction=3),
            Waypoint(position=(8, 3), direction=3), Waypoint(position=(8, 2), direction=3),
            Waypoint(position=(8, 1), direction=3), Waypoint(position=(9, 1), direction=2),
            Waypoint(position=(10, 1), direction=2), Waypoint(position=(11, 1), direction=2),
            Waypoint(position=(12, 1), direction=2), Waypoint(position=(13, 1), direction=2),
            Waypoint(position=(14, 1), direction=2), Waypoint(position=(15, 1), direction=2),
            Waypoint(position=(16, 1), direction=2), Waypoint(position=(17, 1), direction=2),
            Waypoint(position=(18, 1), direction=2), Waypoint(position=(19, 1), direction=2),
            Waypoint(position=(20, 1), direction=2), Waypoint(position=(21, 1), direction=2),
            Waypoint(position=(22, 1), direction=2), Waypoint(position=(23, 1), direction=2),
            Waypoint(position=(23, 2), direction=1), Waypoint(position=(23, 3), direction=1),
            Waypoint(position=(23, 4), direction=1), Waypoint(position=(23, 5), direction=1),
            Waypoint(position=(23, 6), direction=1), Waypoint(position=(23, 7), direction=1),
            Waypoint(position=(23, 8), direction=1), Waypoint(position=(23, 9), direction=1),
            Waypoint(position=(23, 10), direction=1), Waypoint(position=(24, 10), direction=2),
            Waypoint(position=(24, 11), direction=1), Waypoint(position=(24, 12), direction=1),
            Waypoint(position=(24, 13), direction=1), Waypoint(position=(24, 14), direction=1),
            Waypoint(position=(24, 15), direction=1), Waypoint(position=(24, 16), direction=1),
            Waypoint(position=(24, 17), direction=1), Waypoint(position=(24, 18), direction=1),
            Waypoint(position=(24, 19), direction=1), Waypoint(position=(24, 20), direction=1),
            Waypoint(position=(24, 21), direction=1), Waypoint(position=(24, 22), direction=1),
            Waypoint(position=(24, 23), direction=1)),
        (
            Waypoint(position=(6, 23), direction=3), Waypoint(position=(6, 22), direction=3),
            Waypoint(position=(6, 21), direction=3), Waypoint(position=(7, 21), direction=2),
            Waypoint(position=(7, 20), direction=3), Waypoint(position=(7, 19), direction=3),
            Waypoint(position=(7, 18), direction=3), Waypoint(position=(7, 17), direction=3),
            Waypoint(position=(7, 16), direction=3), Waypoint(position=(7, 15), direction=3),
            Waypoint(position=(7, 14), direction=3), Waypoint(position=(7, 13), direction=3),
            Waypoint(position=(7, 12), direction=3), Waypoint(position=(7, 11), direction=3),
            Waypoint(position=(8, 11), direction=2), Waypoint(position=(8, 10), direction=3),
            Waypoint(position=(8, 9), direction=3), Waypoint(position=(8, 8), direction=3),
            Waypoint(position=(8, 7), direction=3), Waypoint(position=(8, 6), direction=3),
            Waypoint(position=(8, 5), direction=3), Waypoint(position=(8, 4), direction=3),
            Waypoint(position=(8, 3), direction=3), Waypoint(position=(8, 2), direction=3),
            Waypoint(position=(8, 1), direction=3), Waypoint(position=(9, 1), direction=2),
            Waypoint(position=(10, 1), direction=2), Waypoint(position=(11, 1), direction=2),
            Waypoint(position=(12, 1), direction=2), Waypoint(position=(13, 1), direction=2),
            Waypoint(position=(14, 1), direction=2), Waypoint(position=(15, 1), direction=2),
            Waypoint(position=(16, 1), direction=2), Waypoint(position=(17, 1), direction=2),
            Waypoint(position=(18, 1), direction=2), Waypoint(position=(19, 1), direction=2),
            Waypoint(position=(20, 1), direction=2), Waypoint(position=(21, 1), direction=2),
            Waypoint(position=(22, 1), direction=2), Waypoint(position=(23, 1), direction=2),
            Waypoint(position=(23, 2), direction=1), Waypoint(position=(23, 3), direction=1),
            Waypoint(position=(24, 3), direction=2), Waypoint(position=(24, 4), direction=1),
            Waypoint(position=(24, 5), direction=1), Waypoint(position=(24, 6), direction=1),
            Waypoint(position=(24, 7), direction=1), Waypoint(position=(24, 8), direction=1),
            Waypoint(position=(24, 9), direction=1), Waypoint(position=(24, 10), direction=1),
            Waypoint(position=(24, 11), direction=1), Waypoint(position=(24, 12), direction=1),
            Waypoint(position=(24, 13), direction=1), Waypoint(position=(24, 14), direction=1),
            Waypoint(position=(24, 15), direction=1), Waypoint(position=(24, 16), direction=1),
            Waypoint(position=(24, 17), direction=1), Waypoint(position=(24, 18), direction=1),
            Waypoint(position=(24, 19), direction=1), Waypoint(position=(24, 20), direction=1),
            Waypoint(position=(24, 21), direction=1), Waypoint(position=(24, 22), direction=1),
            Waypoint(position=(24, 23), direction=1)),
        (
            Waypoint(position=(6, 23), direction=3), Waypoint(position=(6, 22), direction=3),
            Waypoint(position=(6, 21), direction=3), Waypoint(position=(7, 21), direction=2),
            Waypoint(position=(7, 20), direction=3), Waypoint(position=(7, 19), direction=3),
            Waypoint(position=(7, 18), direction=3), Waypoint(position=(7, 17), direction=3),
            Waypoint(position=(7, 16), direction=3), Waypoint(position=(7, 15), direction=3),
            Waypoint(position=(7, 14), direction=3), Waypoint(position=(7, 13), direction=3),
            Waypoint(position=(7, 12), direction=3), Waypoint(position=(7, 11), direction=3),
            Waypoint(position=(8, 11), direction=2), Waypoint(position=(8, 10), direction=3),
            Waypoint(position=(8, 9), direction=3), Waypoint(position=(8, 8), direction=3),
            Waypoint(position=(8, 7), direction=3), Waypoint(position=(8, 6), direction=3),
            Waypoint(position=(8, 5), direction=3), Waypoint(position=(8, 4), direction=3),
            Waypoint(position=(8, 3), direction=3), Waypoint(position=(8, 2), direction=3),
            Waypoint(position=(8, 1), direction=3), Waypoint(position=(9, 1), direction=2),
            Waypoint(position=(10, 1), direction=2), Waypoint(position=(11, 1), direction=2),
            Waypoint(position=(12, 1), direction=2), Waypoint(position=(13, 1), direction=2),
            Waypoint(position=(14, 1), direction=2), Waypoint(position=(15, 1), direction=2),
            Waypoint(position=(16, 1), direction=2), Waypoint(position=(17, 1), direction=2),
            Waypoint(position=(18, 1), direction=2), Waypoint(position=(19, 1), direction=2),
            Waypoint(position=(20, 1), direction=2), Waypoint(position=(21, 1), direction=2),
            Waypoint(position=(22, 1), direction=2), Waypoint(position=(23, 1), direction=2),
            Waypoint(position=(24, 1), direction=2), Waypoint(position=(24, 2), direction=1),
            Waypoint(position=(24, 3), direction=1), Waypoint(position=(24, 4), direction=1),
            Waypoint(position=(24, 5), direction=1), Waypoint(position=(24, 6), direction=1),
            Waypoint(position=(24, 7), direction=1), Waypoint(position=(24, 8), direction=1),
            Waypoint(position=(24, 9), direction=1), Waypoint(position=(24, 10), direction=1),
            Waypoint(position=(24, 11), direction=1), Waypoint(position=(24, 12), direction=1),
            Waypoint(position=(24, 13), direction=1), Waypoint(position=(24, 14), direction=1),
            Waypoint(position=(24, 15), direction=1), Waypoint(position=(24, 16), direction=1),
            Waypoint(position=(24, 17), direction=1), Waypoint(position=(24, 18), direction=1),
            Waypoint(position=(24, 19), direction=1), Waypoint(position=(24, 20), direction=1),
            Waypoint(position=(24, 21), direction=1), Waypoint(position=(24, 22), direction=1),
            Waypoint(position=(24, 23), direction=1)),
        (
            Waypoint(position=(6, 23), direction=3), Waypoint(position=(6, 22), direction=3),
            Waypoint(position=(6, 21), direction=3), Waypoint(position=(7, 21), direction=2),
            Waypoint(position=(7, 20), direction=3), Waypoint(position=(7, 19), direction=3),
            Waypoint(position=(7, 18), direction=3), Waypoint(position=(7, 17), direction=3),
            Waypoint(position=(7, 16), direction=3), Waypoint(position=(7, 15), direction=3),
            Waypoint(position=(7, 14), direction=3), Waypoint(position=(7, 13), direction=3),
            Waypoint(position=(7, 12), direction=3), Waypoint(position=(7, 11), direction=3),
            Waypoint(position=(7, 10), direction=3), Waypoint(position=(7, 9), direction=3),
            Waypoint(position=(7, 8), direction=3), Waypoint(position=(7, 7), direction=3),
            Waypoint(position=(7, 6), direction=3), Waypoint(position=(7, 5), direction=3),
            Waypoint(position=(7, 4), direction=3), Waypoint(position=(8, 4), direction=2),
            Waypoint(position=(8, 3), direction=3), Waypoint(position=(8, 2), direction=3),
            Waypoint(position=(8, 1), direction=3), Waypoint(position=(9, 1), direction=2),
            Waypoint(position=(10, 1), direction=2), Waypoint(position=(11, 1), direction=2),
            Waypoint(position=(12, 1), direction=2), Waypoint(position=(13, 1), direction=2),
            Waypoint(position=(14, 1), direction=2), Waypoint(position=(15, 1), direction=2),
            Waypoint(position=(16, 1), direction=2), Waypoint(position=(17, 1), direction=2),
            Waypoint(position=(18, 1), direction=2), Waypoint(position=(19, 1), direction=2),
            Waypoint(position=(20, 1), direction=2), Waypoint(position=(21, 1), direction=2),
            Waypoint(position=(22, 1), direction=2), Waypoint(position=(23, 1), direction=2),
            Waypoint(position=(23, 2), direction=1), Waypoint(position=(23, 3), direction=1),
            Waypoint(position=(23, 4), direction=1), Waypoint(position=(23, 5), direction=1),
            Waypoint(position=(23, 6), direction=1), Waypoint(position=(23, 7), direction=1),
            Waypoint(position=(23, 8), direction=1), Waypoint(position=(23, 9), direction=1),
            Waypoint(position=(23, 10), direction=1), Waypoint(position=(23, 11), direction=1),
            Waypoint(position=(23, 12), direction=1), Waypoint(position=(23, 13), direction=1),
            Waypoint(position=(23, 14), direction=1), Waypoint(position=(23, 15), direction=1),
            Waypoint(position=(23, 16), direction=1), Waypoint(position=(23, 17), direction=1),
            Waypoint(position=(23, 18), direction=1), Waypoint(position=(23, 19), direction=1),
            Waypoint(position=(24, 19), direction=2), Waypoint(position=(24, 20), direction=1),
            Waypoint(position=(24, 21), direction=1), Waypoint(position=(24, 22), direction=1),
            Waypoint(position=(24, 23), direction=1)),
        (
            Waypoint(position=(6, 23), direction=3), Waypoint(position=(6, 22), direction=3),
            Waypoint(position=(6, 21), direction=3), Waypoint(position=(7, 21), direction=2),
            Waypoint(position=(7, 20), direction=3), Waypoint(position=(7, 19), direction=3),
            Waypoint(position=(7, 18), direction=3), Waypoint(position=(7, 17), direction=3),
            Waypoint(position=(7, 16), direction=3), Waypoint(position=(7, 15), direction=3),
            Waypoint(position=(7, 14), direction=3), Waypoint(position=(7, 13), direction=3),
            Waypoint(position=(7, 12), direction=3), Waypoint(position=(7, 11), direction=3),
            Waypoint(position=(7, 10), direction=3), Waypoint(position=(7, 9), direction=3),
            Waypoint(position=(7, 8), direction=3), Waypoint(position=(7, 7), direction=3),
            Waypoint(position=(7, 6), direction=3), Waypoint(position=(7, 5), direction=3),
            Waypoint(position=(7, 4), direction=3), Waypoint(position=(8, 4), direction=2),
            Waypoint(position=(8, 3), direction=3), Waypoint(position=(8, 2), direction=3),
            Waypoint(position=(8, 1), direction=3), Waypoint(position=(9, 1), direction=2),
            Waypoint(position=(10, 1), direction=2), Waypoint(position=(11, 1), direction=2),
            Waypoint(position=(12, 1), direction=2), Waypoint(position=(13, 1), direction=2),
            Waypoint(position=(14, 1), direction=2), Waypoint(position=(15, 1), direction=2),
            Waypoint(position=(16, 1), direction=2), Waypoint(position=(17, 1), direction=2),
            Waypoint(position=(18, 1), direction=2), Waypoint(position=(19, 1), direction=2),
            Waypoint(position=(20, 1), direction=2), Waypoint(position=(21, 1), direction=2),
            Waypoint(position=(22, 1), direction=2), Waypoint(position=(23, 1), direction=2),
            Waypoint(position=(23, 2), direction=1), Waypoint(position=(23, 3), direction=1),
            Waypoint(position=(23, 4), direction=1), Waypoint(position=(23, 5), direction=1),
            Waypoint(position=(23, 6), direction=1), Waypoint(position=(23, 7), direction=1),
            Waypoint(position=(23, 8), direction=1), Waypoint(position=(23, 9), direction=1),
            Waypoint(position=(23, 10), direction=1), Waypoint(position=(24, 10), direction=2),
            Waypoint(position=(24, 11), direction=1), Waypoint(position=(24, 12), direction=1),
            Waypoint(position=(24, 13), direction=1), Waypoint(position=(24, 14), direction=1),
            Waypoint(position=(24, 15), direction=1), Waypoint(position=(24, 16), direction=1),
            Waypoint(position=(24, 17), direction=1), Waypoint(position=(24, 18), direction=1),
            Waypoint(position=(24, 19), direction=1), Waypoint(position=(24, 20), direction=1),
            Waypoint(position=(24, 21), direction=1), Waypoint(position=(24, 22), direction=1),
            Waypoint(position=(24, 23), direction=1))]
    return agent_paths, train_run


def test_get_freeze_for_full_rescheduling():
    agent_paths, train_run = _get_data()
    malfunction = ExperimentMalfunction(time_step=19, agent_id=2, malfunction_duration=20)
    expected_route_dag_constraints = RouteDAGConstraints(
        earliest=route_dag_constraints_dict_from_list_of_train_run_waypoint([
            TrainrunWaypoint(scheduled_at=1, waypoint=Waypoint(position=(6, 23), direction=3)),
            TrainrunWaypoint(scheduled_at=2, waypoint=Waypoint(position=(6, 22), direction=3)),
            TrainrunWaypoint(scheduled_at=3, waypoint=Waypoint(position=(6, 21), direction=3)),
            TrainrunWaypoint(scheduled_at=4, waypoint=Waypoint(position=(7, 21), direction=2)),
            TrainrunWaypoint(scheduled_at=5, waypoint=Waypoint(position=(7, 20), direction=3)),
            TrainrunWaypoint(scheduled_at=6, waypoint=Waypoint(position=(8, 20), direction=2)),
            TrainrunWaypoint(scheduled_at=7, waypoint=Waypoint(position=(8, 19), direction=3)),
            TrainrunWaypoint(scheduled_at=8, waypoint=Waypoint(position=(8, 18), direction=3)),
            TrainrunWaypoint(scheduled_at=9, waypoint=Waypoint(position=(8, 17), direction=3)),
            TrainrunWaypoint(scheduled_at=10, waypoint=Waypoint(position=(8, 16), direction=3)),
            TrainrunWaypoint(scheduled_at=11, waypoint=Waypoint(position=(8, 15), direction=3)),
            TrainrunWaypoint(scheduled_at=12, waypoint=Waypoint(position=(8, 14), direction=3)),
            TrainrunWaypoint(scheduled_at=13, waypoint=Waypoint(position=(8, 13), direction=3)),
            TrainrunWaypoint(scheduled_at=14, waypoint=Waypoint(position=(8, 12), direction=3)),
            TrainrunWaypoint(scheduled_at=15, waypoint=Waypoint(position=(8, 11), direction=3)),
            TrainrunWaypoint(scheduled_at=16, waypoint=Waypoint(position=(8, 10), direction=3)),
            TrainrunWaypoint(scheduled_at=17, waypoint=Waypoint(position=(8, 9), direction=3)),
            TrainrunWaypoint(scheduled_at=18, waypoint=Waypoint(position=(8, 8), direction=3)),
            TrainrunWaypoint(scheduled_at=19, waypoint=Waypoint(position=(8, 7), direction=3)),
            TrainrunWaypoint(scheduled_at=40, waypoint=Waypoint(position=(8, 6), direction=3)),
            TrainrunWaypoint(scheduled_at=21 + 20, waypoint=Waypoint(position=(8, 5), direction=3)),
            TrainrunWaypoint(scheduled_at=22 + 20, waypoint=Waypoint(position=(8, 4), direction=3)),
            TrainrunWaypoint(scheduled_at=23 + 20, waypoint=Waypoint(position=(8, 3), direction=3)),
            TrainrunWaypoint(scheduled_at=24 + 20, waypoint=Waypoint(position=(8, 2), direction=3)),
            TrainrunWaypoint(scheduled_at=25 + 20, waypoint=Waypoint(position=(8, 1), direction=3)),
            TrainrunWaypoint(scheduled_at=26 + 20, waypoint=Waypoint(position=(9, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=27 + 20, waypoint=Waypoint(position=(10, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=28 + 20, waypoint=Waypoint(position=(11, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=29 + 20, waypoint=Waypoint(position=(12, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=30 + 20, waypoint=Waypoint(position=(13, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=31 + 20, waypoint=Waypoint(position=(14, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=32 + 20, waypoint=Waypoint(position=(15, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=33 + 20, waypoint=Waypoint(position=(16, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=34 + 20, waypoint=Waypoint(position=(17, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=35 + 20, waypoint=Waypoint(position=(18, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=36 + 20, waypoint=Waypoint(position=(19, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=37 + 20, waypoint=Waypoint(position=(20, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=38 + 20, waypoint=Waypoint(position=(21, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=39 + 20, waypoint=Waypoint(position=(22, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=40 + 20, waypoint=Waypoint(position=(23, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=41 + 20, waypoint=Waypoint(position=(23, 2), direction=1)),
            TrainrunWaypoint(scheduled_at=42 + 20, waypoint=Waypoint(position=(23, 3), direction=1)),
            TrainrunWaypoint(scheduled_at=43 + 20, waypoint=Waypoint(position=(23, 4), direction=1)),
            TrainrunWaypoint(scheduled_at=44 + 20, waypoint=Waypoint(position=(23, 5), direction=1)),
            TrainrunWaypoint(scheduled_at=45 + 20, waypoint=Waypoint(position=(23, 6), direction=1)),
            TrainrunWaypoint(scheduled_at=46 + 20, waypoint=Waypoint(position=(23, 7), direction=1)),
            TrainrunWaypoint(scheduled_at=47 + 20, waypoint=Waypoint(position=(23, 8), direction=1)),
            TrainrunWaypoint(scheduled_at=48 + 20, waypoint=Waypoint(position=(23, 9), direction=1)),
            TrainrunWaypoint(scheduled_at=49 + 20, waypoint=Waypoint(position=(23, 10), direction=1)),
            TrainrunWaypoint(scheduled_at=50 + 20, waypoint=Waypoint(position=(23, 11), direction=1)),
            TrainrunWaypoint(scheduled_at=51 + 20, waypoint=Waypoint(position=(23, 12), direction=1)),
            TrainrunWaypoint(scheduled_at=52 + 20, waypoint=Waypoint(position=(23, 13), direction=1)),
            TrainrunWaypoint(scheduled_at=53 + 20, waypoint=Waypoint(position=(23, 14), direction=1)),
            TrainrunWaypoint(scheduled_at=54 + 20, waypoint=Waypoint(position=(23, 15), direction=1)),
            TrainrunWaypoint(scheduled_at=55 + 20, waypoint=Waypoint(position=(23, 16), direction=1)),
            TrainrunWaypoint(scheduled_at=56 + 20, waypoint=Waypoint(position=(23, 17), direction=1)),
            TrainrunWaypoint(scheduled_at=57 + 20, waypoint=Waypoint(position=(23, 18), direction=1)),
            TrainrunWaypoint(scheduled_at=58 + 20, waypoint=Waypoint(position=(23, 19), direction=1)),
            TrainrunWaypoint(scheduled_at=59 + 20, waypoint=Waypoint(position=(24, 19), direction=2)),
            TrainrunWaypoint(scheduled_at=60 + 20, waypoint=Waypoint(position=(24, 20), direction=1)),
            TrainrunWaypoint(scheduled_at=61 + 20, waypoint=Waypoint(position=(24, 21), direction=1)),
            TrainrunWaypoint(scheduled_at=62 + 20, waypoint=Waypoint(position=(24, 22), direction=1)),
            TrainrunWaypoint(scheduled_at=63 + 20, waypoint=Waypoint(position=(24, 23), direction=1)),

            TrainrunWaypoint(scheduled_at=50 + 20, waypoint=Waypoint(position=(24, 10), direction=2)),
            TrainrunWaypoint(scheduled_at=51 + 20, waypoint=Waypoint(position=(24, 11), direction=1)),
            TrainrunWaypoint(scheduled_at=52 + 20, waypoint=Waypoint(position=(24, 12), direction=1)),
            TrainrunWaypoint(scheduled_at=53 + 20, waypoint=Waypoint(position=(24, 13), direction=1)),
            TrainrunWaypoint(scheduled_at=54 + 20, waypoint=Waypoint(position=(24, 14), direction=1)),
            TrainrunWaypoint(scheduled_at=55 + 20, waypoint=Waypoint(position=(24, 15), direction=1)),
            TrainrunWaypoint(scheduled_at=56 + 20, waypoint=Waypoint(position=(24, 16), direction=1)),
            TrainrunWaypoint(scheduled_at=57 + 20, waypoint=Waypoint(position=(24, 17), direction=1)),
            TrainrunWaypoint(scheduled_at=58 + 20, waypoint=Waypoint(position=(24, 18), direction=1)),
            TrainrunWaypoint(scheduled_at=59 + 20, waypoint=Waypoint(position=(24, 19), direction=1)),

            TrainrunWaypoint(scheduled_at=43 + 20, waypoint=Waypoint(position=(24, 3), direction=2)),
            TrainrunWaypoint(scheduled_at=44 + 20, waypoint=Waypoint(position=(24, 4), direction=1)),
            TrainrunWaypoint(scheduled_at=45 + 20, waypoint=Waypoint(position=(24, 5), direction=1)),
            TrainrunWaypoint(scheduled_at=46 + 20, waypoint=Waypoint(position=(24, 6), direction=1)),
            TrainrunWaypoint(scheduled_at=47 + 20, waypoint=Waypoint(position=(24, 7), direction=1)),
            TrainrunWaypoint(scheduled_at=48 + 20, waypoint=Waypoint(position=(24, 8), direction=1)),
            TrainrunWaypoint(scheduled_at=49 + 20, waypoint=Waypoint(position=(24, 9), direction=1)),
            TrainrunWaypoint(scheduled_at=50 + 20, waypoint=Waypoint(position=(24, 10), direction=1)),

            TrainrunWaypoint(scheduled_at=41 + 20, waypoint=Waypoint(position=(24, 1), direction=2)),
            TrainrunWaypoint(scheduled_at=42 + 20, waypoint=Waypoint(position=(24, 2), direction=1)),
            TrainrunWaypoint(scheduled_at=43 + 20, waypoint=Waypoint(position=(24, 3), direction=1)),

        ]),
        latest=[]
    )
    topo_dict = _get_topology_from_agents_path_dict({2: agent_paths})
    reschedule_full_problem_description: ScheduleProblemDescription = delta_zero_for_all_agents(
        minimum_travel_time_dict={2: 1},
        topo_dict_=topo_dict,
        malfunction=malfunction,
        schedule_trainruns={2: train_run},
        latest_arrival=333,
        weight_lateness_seconds=1,
        weight_route_change=1
    )
    route_dag_constraints: RouteDAGConstraints = reschedule_full_problem_description.route_dag_constraints_dict[2]
    print(f"earliest={_pp.pformat(route_dag_constraints.earliest)}")
    print(f"latest={_pp.pformat(route_dag_constraints.latest)}")

    assert dict(route_dag_constraints.earliest) == dict(expected_route_dag_constraints.earliest), \
        "\n" \
        f"actual=  {dict(route_dag_constraints.earliest)}, \n" \
        f"expected={expected_route_dag_constraints.earliest}" \
        f"not expected keys={set(route_dag_constraints.earliest.keys()) - set(expected_route_dag_constraints.earliest.keys())}"


def test_get_freeze_for_delta_perfect():
    agents_path_dict = {0: [(
        Waypoint(position=(8, 23), direction=1),
        Waypoint(position=(8, 24), direction=1),
        Waypoint(position=(8, 25), direction=1),
        Waypoint(position=(8, 26), direction=1),
        Waypoint(position=(8, 27), direction=1),
        Waypoint(position=(8, 28), direction=1),
        Waypoint(position=(8, 29), direction=1),
        Waypoint(position=(9, 29), direction=2),
        Waypoint(position=(10, 29), direction=2),
        Waypoint(position=(11, 29), direction=2),
        Waypoint(position=(12, 29), direction=2),
        Waypoint(position=(13, 29), direction=2),
        Waypoint(position=(14, 29), direction=2),
        Waypoint(position=(15, 29), direction=2),
        Waypoint(position=(16, 29), direction=2),
        Waypoint(position=(17, 29), direction=2),
        Waypoint(position=(18, 29), direction=2),
        Waypoint(position=(19, 29), direction=2),
        Waypoint(position=(20, 29), direction=2),
        Waypoint(position=(21, 29), direction=2),
        Waypoint(position=(22, 29), direction=2),
        Waypoint(position=(23, 29), direction=2),
        Waypoint(position=(24, 29), direction=2),
        Waypoint(position=(24, 28), direction=3),
        Waypoint(position=(24, 27), direction=3),
        Waypoint(position=(24, 26), direction=3),
        Waypoint(position=(24, 25), direction=3),
        Waypoint(position=(24, 24), direction=3),
        Waypoint(position=(24, 23), direction=3)),
        (
            Waypoint(position=(8, 23), direction=1),
            Waypoint(position=(8, 24), direction=1),
            Waypoint(position=(8, 25), direction=1),
            Waypoint(position=(8, 26), direction=1),
            Waypoint(position=(8, 27), direction=1),
            Waypoint(position=(8, 28), direction=1),
            Waypoint(position=(8, 29), direction=1),
            Waypoint(position=(9, 29), direction=2),
            Waypoint(position=(10, 29), direction=2),
            Waypoint(position=(11, 29), direction=2),
            Waypoint(position=(12, 29), direction=2),
            Waypoint(position=(13, 29), direction=2),
            Waypoint(position=(14, 29), direction=2),
            Waypoint(position=(15, 29), direction=2),
            Waypoint(position=(16, 29), direction=2),
            Waypoint(position=(17, 29), direction=2),
            Waypoint(position=(18, 29), direction=2),
            Waypoint(position=(19, 29), direction=2),
            Waypoint(position=(20, 29), direction=2),
            Waypoint(position=(21, 29), direction=2),
            Waypoint(position=(22, 29), direction=2),
            Waypoint(position=(23, 29), direction=2),
            Waypoint(position=(23, 28), direction=3),
            Waypoint(position=(23, 27), direction=3),
            Waypoint(position=(24, 27), direction=2),
            Waypoint(position=(24, 26), direction=3),
            Waypoint(position=(24, 25), direction=3),
            Waypoint(position=(24, 24), direction=3),
            Waypoint(position=(24, 23), direction=3)),
        (
            Waypoint(position=(8, 23), direction=1),
            Waypoint(position=(8, 24), direction=1),
            Waypoint(position=(8, 25), direction=1),
            Waypoint(position=(8, 26), direction=1),
            Waypoint(position=(8, 27), direction=1),
            Waypoint(position=(7, 27), direction=0),
            Waypoint(position=(7, 28), direction=1),
            Waypoint(position=(7, 29), direction=1),
            Waypoint(position=(8, 29), direction=2),
            Waypoint(position=(9, 29), direction=2),
            Waypoint(position=(10, 29), direction=2),
            Waypoint(position=(11, 29), direction=2),
            Waypoint(position=(12, 29), direction=2),
            Waypoint(position=(13, 29), direction=2),
            Waypoint(position=(14, 29), direction=2),
            Waypoint(position=(15, 29), direction=2),
            Waypoint(position=(16, 29), direction=2),
            Waypoint(position=(17, 29), direction=2),
            Waypoint(position=(18, 29), direction=2),
            Waypoint(position=(19, 29), direction=2),
            Waypoint(position=(20, 29), direction=2),
            Waypoint(position=(21, 29), direction=2),
            Waypoint(position=(22, 29), direction=2),
            Waypoint(position=(23, 29), direction=2),
            Waypoint(position=(24, 29), direction=2),
            Waypoint(position=(24, 28), direction=3),
            Waypoint(position=(24, 27), direction=3),
            Waypoint(position=(24, 26), direction=3),
            Waypoint(position=(24, 25), direction=3),
            Waypoint(position=(24, 24), direction=3),
            Waypoint(position=(24, 23), direction=3)),
        (
            Waypoint(position=(8, 23), direction=1),
            Waypoint(position=(8, 24), direction=1),
            Waypoint(position=(8, 25), direction=1),
            Waypoint(position=(8, 26), direction=1),
            Waypoint(position=(8, 27), direction=1),
            Waypoint(position=(7, 27), direction=0),
            Waypoint(position=(7, 28), direction=1),
            Waypoint(position=(7, 29), direction=1),
            Waypoint(position=(8, 29), direction=2),
            Waypoint(position=(9, 29), direction=2),
            Waypoint(position=(10, 29), direction=2),
            Waypoint(position=(11, 29), direction=2),
            Waypoint(position=(12, 29), direction=2),
            Waypoint(position=(13, 29), direction=2),
            Waypoint(position=(14, 29), direction=2),
            Waypoint(position=(15, 29), direction=2),
            Waypoint(position=(16, 29), direction=2),
            Waypoint(position=(17, 29), direction=2),
            Waypoint(position=(18, 29), direction=2),
            Waypoint(position=(19, 29), direction=2),
            Waypoint(position=(20, 29), direction=2),
            Waypoint(position=(21, 29), direction=2),
            Waypoint(position=(22, 29), direction=2),
            Waypoint(position=(23, 29), direction=2),
            Waypoint(position=(23, 28), direction=3),
            Waypoint(position=(23, 27), direction=3),
            Waypoint(position=(24, 27), direction=2),
            Waypoint(position=(24, 26), direction=3),
            Waypoint(position=(24, 25), direction=3),
            Waypoint(position=(24, 24), direction=3),
            Waypoint(position=(24, 23), direction=3)),
        (
            Waypoint(position=(8, 23), direction=1),
            Waypoint(position=(8, 24), direction=1),
            Waypoint(position=(8, 25), direction=1),
            Waypoint(position=(8, 26), direction=1),
            Waypoint(position=(8, 27), direction=1),
            Waypoint(position=(8, 28), direction=1),
            Waypoint(position=(8, 29), direction=1),
            Waypoint(position=(9, 29), direction=2),
            Waypoint(position=(10, 29), direction=2),
            Waypoint(position=(11, 29), direction=2),
            Waypoint(position=(12, 29), direction=2),
            Waypoint(position=(13, 29), direction=2),
            Waypoint(position=(13, 28), direction=3),
            Waypoint(position=(14, 28), direction=2),
            Waypoint(position=(15, 28), direction=2),
            Waypoint(position=(16, 28), direction=2),
            Waypoint(position=(17, 28), direction=2),
            Waypoint(position=(17, 29), direction=1),
            Waypoint(position=(18, 29), direction=2),
            Waypoint(position=(19, 29), direction=2),
            Waypoint(position=(20, 29), direction=2),
            Waypoint(position=(21, 29), direction=2),
            Waypoint(position=(22, 29), direction=2),
            Waypoint(position=(23, 29), direction=2),
            Waypoint(position=(24, 29), direction=2),
            Waypoint(position=(24, 28), direction=3),
            Waypoint(position=(24, 27), direction=3),
            Waypoint(position=(24, 26), direction=3),
            Waypoint(position=(24, 25), direction=3),
            Waypoint(position=(24, 24), direction=3),
            Waypoint(position=(24, 23), direction=3)),
        (
            Waypoint(position=(8, 23), direction=1),
            Waypoint(position=(8, 24), direction=1),
            Waypoint(position=(8, 25), direction=1),
            Waypoint(position=(8, 26), direction=1),
            Waypoint(position=(8, 27), direction=1),
            Waypoint(position=(8, 28), direction=1),
            Waypoint(position=(8, 29), direction=1),
            Waypoint(position=(9, 29), direction=2),
            Waypoint(position=(10, 29), direction=2),
            Waypoint(position=(11, 29), direction=2),
            Waypoint(position=(12, 29), direction=2),
            Waypoint(position=(13, 29), direction=2),
            Waypoint(position=(13, 28), direction=3),
            Waypoint(position=(14, 28), direction=2),
            Waypoint(position=(15, 28), direction=2),
            Waypoint(position=(16, 28), direction=2),
            Waypoint(position=(17, 28), direction=2),
            Waypoint(position=(17, 29), direction=1),
            Waypoint(position=(18, 29), direction=2),
            Waypoint(position=(19, 29), direction=2),
            Waypoint(position=(20, 29), direction=2),
            Waypoint(position=(21, 29), direction=2),
            Waypoint(position=(22, 29), direction=2),
            Waypoint(position=(23, 29), direction=2),
            Waypoint(position=(23, 28), direction=3),
            Waypoint(position=(23, 27), direction=3),
            Waypoint(position=(24, 27), direction=2),
            Waypoint(position=(24, 26), direction=3),
            Waypoint(position=(24, 25), direction=3),
            Waypoint(position=(24, 24), direction=3),
            Waypoint(position=(24, 23), direction=3)),
        (
            Waypoint(position=(8, 23), direction=1),
            Waypoint(position=(8, 24), direction=1),
            Waypoint(position=(8, 25), direction=1),
            Waypoint(position=(8, 26), direction=1),
            Waypoint(position=(8, 27), direction=1),
            Waypoint(position=(7, 27), direction=0),
            Waypoint(position=(7, 28), direction=1),
            Waypoint(position=(7, 29), direction=1),
            Waypoint(position=(8, 29), direction=2),
            Waypoint(position=(9, 29), direction=2),
            Waypoint(position=(10, 29), direction=2),
            Waypoint(position=(11, 29), direction=2),
            Waypoint(position=(12, 29), direction=2),
            Waypoint(position=(13, 29), direction=2),
            Waypoint(position=(13, 28), direction=3),
            Waypoint(position=(14, 28), direction=2),
            Waypoint(position=(15, 28), direction=2),
            Waypoint(position=(16, 28), direction=2),
            Waypoint(position=(17, 28), direction=2),
            Waypoint(position=(17, 29), direction=1),
            Waypoint(position=(18, 29), direction=2),
            Waypoint(position=(19, 29), direction=2),
            Waypoint(position=(20, 29), direction=2),
            Waypoint(position=(21, 29), direction=2),
            Waypoint(position=(22, 29), direction=2),
            Waypoint(position=(23, 29), direction=2),
            Waypoint(position=(24, 29), direction=2),
            Waypoint(position=(24, 28), direction=3),
            Waypoint(position=(24, 27), direction=3),
            Waypoint(position=(24, 26), direction=3),
            Waypoint(position=(24, 25), direction=3),
            Waypoint(position=(24, 24), direction=3),
            Waypoint(position=(24, 23), direction=3)),
        (
            Waypoint(position=(8, 23), direction=1),
            Waypoint(position=(8, 24), direction=1),
            Waypoint(position=(8, 25), direction=1),
            Waypoint(position=(8, 26), direction=1),
            Waypoint(position=(8, 27), direction=1),
            Waypoint(position=(7, 27), direction=0),
            Waypoint(position=(7, 28), direction=1),
            Waypoint(position=(7, 29), direction=1),
            Waypoint(position=(8, 29), direction=2),
            Waypoint(position=(9, 29), direction=2),
            Waypoint(position=(10, 29), direction=2),
            Waypoint(position=(11, 29), direction=2),
            Waypoint(position=(12, 29), direction=2),
            Waypoint(position=(13, 29), direction=2),
            Waypoint(position=(13, 28), direction=3),
            Waypoint(position=(14, 28), direction=2),
            Waypoint(position=(15, 28), direction=2),
            Waypoint(position=(16, 28), direction=2),
            Waypoint(position=(17, 28), direction=2),
            Waypoint(position=(17, 29), direction=1),
            Waypoint(position=(18, 29), direction=2),
            Waypoint(position=(19, 29), direction=2),
            Waypoint(position=(20, 29), direction=2),
            Waypoint(position=(21, 29), direction=2),
            Waypoint(position=(22, 29), direction=2),
            Waypoint(position=(23, 29), direction=2),
            Waypoint(position=(23, 28), direction=3),
            Waypoint(position=(23, 27), direction=3),
            Waypoint(position=(24, 27), direction=2),
            Waypoint(position=(24, 26), direction=3),
            Waypoint(position=(24, 25), direction=3),
            Waypoint(position=(24, 24), direction=3),
            Waypoint(position=(24, 23), direction=3))],
        1: [(
            Waypoint(position=(23, 23), direction=1),
            Waypoint(position=(23, 24), direction=1),
            Waypoint(position=(23, 25), direction=1),
            Waypoint(position=(23, 26), direction=1),
            Waypoint(position=(23, 27), direction=1),
            Waypoint(position=(23, 28), direction=1),
            Waypoint(position=(23, 29), direction=1),
            Waypoint(position=(22, 29), direction=0),
            Waypoint(position=(21, 29), direction=0),
            Waypoint(position=(20, 29), direction=0),
            Waypoint(position=(19, 29), direction=0),
            Waypoint(position=(18, 29), direction=0),
            Waypoint(position=(17, 29), direction=0),
            Waypoint(position=(16, 29), direction=0),
            Waypoint(position=(15, 29), direction=0),
            Waypoint(position=(14, 29), direction=0),
            Waypoint(position=(13, 29), direction=0),
            Waypoint(position=(12, 29), direction=0),
            Waypoint(position=(11, 29), direction=0),
            Waypoint(position=(10, 29), direction=0),
            Waypoint(position=(9, 29), direction=0),
            Waypoint(position=(8, 29), direction=0),
            Waypoint(position=(7, 29), direction=0),
            Waypoint(position=(7, 28), direction=3),
            Waypoint(position=(7, 27), direction=3),
            Waypoint(position=(7, 26), direction=3),
            Waypoint(position=(7, 25), direction=3),
            Waypoint(position=(7, 24), direction=3),
            Waypoint(position=(7, 23), direction=3)),
            (
                Waypoint(position=(23, 23), direction=1),
                Waypoint(position=(23, 24), direction=1),
                Waypoint(position=(23, 25), direction=1),
                Waypoint(position=(23, 26), direction=1),
                Waypoint(position=(23, 27), direction=1),
                Waypoint(position=(23, 28), direction=1),
                Waypoint(position=(23, 29), direction=1),
                Waypoint(position=(22, 29), direction=0),
                Waypoint(position=(21, 29), direction=0),
                Waypoint(position=(20, 29), direction=0),
                Waypoint(position=(19, 29), direction=0),
                Waypoint(position=(18, 29), direction=0),
                Waypoint(position=(17, 29), direction=0),
                Waypoint(position=(16, 29), direction=0),
                Waypoint(position=(15, 29), direction=0),
                Waypoint(position=(14, 29), direction=0),
                Waypoint(position=(13, 29), direction=0),
                Waypoint(position=(12, 29), direction=0),
                Waypoint(position=(11, 29), direction=0),
                Waypoint(position=(10, 29), direction=0),
                Waypoint(position=(9, 29), direction=0),
                Waypoint(position=(8, 29), direction=0),
                Waypoint(position=(8, 28), direction=3),
                Waypoint(position=(8, 27), direction=3),
                Waypoint(position=(8, 26), direction=3),
                Waypoint(position=(7, 26), direction=0),
                Waypoint(position=(7, 25), direction=3),
                Waypoint(position=(7, 24), direction=3),
                Waypoint(position=(7, 23), direction=3)),
            (
                Waypoint(position=(23, 23), direction=1),
                Waypoint(position=(23, 24), direction=1),
                Waypoint(position=(23, 25), direction=1),
                Waypoint(position=(23, 26), direction=1),
                Waypoint(position=(23, 27), direction=1),
                Waypoint(position=(23, 28), direction=1),
                Waypoint(position=(23, 29), direction=1),
                Waypoint(position=(22, 29), direction=0),
                Waypoint(position=(21, 29), direction=0),
                Waypoint(position=(20, 29), direction=0),
                Waypoint(position=(19, 29), direction=0),
                Waypoint(position=(18, 29), direction=0),
                Waypoint(position=(17, 29), direction=0),
                Waypoint(position=(16, 29), direction=0),
                Waypoint(position=(15, 29), direction=0),
                Waypoint(position=(14, 29), direction=0),
                Waypoint(position=(13, 29), direction=0),
                Waypoint(position=(12, 29), direction=0),
                Waypoint(position=(11, 29), direction=0),
                Waypoint(position=(10, 29), direction=0),
                Waypoint(position=(9, 29), direction=0),
                Waypoint(position=(8, 29), direction=0),
                Waypoint(position=(7, 29), direction=0),
                Waypoint(position=(7, 28), direction=3),
                Waypoint(position=(7, 27), direction=3),
                Waypoint(position=(8, 27), direction=2),
                Waypoint(position=(8, 26), direction=3),
                Waypoint(position=(7, 26), direction=0),
                Waypoint(position=(7, 25), direction=3),
                Waypoint(position=(7, 24), direction=3),
                Waypoint(position=(7, 23), direction=3)),
            (
                Waypoint(position=(23, 23), direction=1),
                Waypoint(position=(23, 24), direction=1),
                Waypoint(position=(23, 25), direction=1),
                Waypoint(position=(23, 26), direction=1),
                Waypoint(position=(23, 27), direction=1),
                Waypoint(position=(23, 28), direction=1),
                Waypoint(position=(23, 29), direction=1),
                Waypoint(position=(22, 29), direction=0),
                Waypoint(position=(21, 29), direction=0),
                Waypoint(position=(20, 29), direction=0),
                Waypoint(position=(19, 29), direction=0),
                Waypoint(position=(18, 29), direction=0),
                Waypoint(position=(17, 29), direction=0),
                Waypoint(position=(17, 28), direction=3),
                Waypoint(position=(16, 28), direction=0),
                Waypoint(position=(15, 28), direction=0),
                Waypoint(position=(14, 28), direction=0),
                Waypoint(position=(13, 28), direction=0),
                Waypoint(position=(13, 29), direction=1),
                Waypoint(position=(12, 29), direction=0),
                Waypoint(position=(11, 29), direction=0),
                Waypoint(position=(10, 29), direction=0),
                Waypoint(position=(9, 29), direction=0),
                Waypoint(position=(8, 29), direction=0),
                Waypoint(position=(7, 29), direction=0),
                Waypoint(position=(7, 28), direction=3),
                Waypoint(position=(7, 27), direction=3),
                Waypoint(position=(7, 26), direction=3),
                Waypoint(position=(7, 25), direction=3),
                Waypoint(position=(7, 24), direction=3),
                Waypoint(position=(7, 23), direction=3)),
            (
                Waypoint(position=(23, 23), direction=1),
                Waypoint(position=(23, 24), direction=1),
                Waypoint(position=(23, 25), direction=1),
                Waypoint(position=(23, 26), direction=1),
                Waypoint(position=(23, 27), direction=1),
                Waypoint(position=(23, 28), direction=1),
                Waypoint(position=(23, 29), direction=1),
                Waypoint(position=(22, 29), direction=0),
                Waypoint(position=(21, 29), direction=0),
                Waypoint(position=(20, 29), direction=0),
                Waypoint(position=(19, 29), direction=0),
                Waypoint(position=(18, 29), direction=0),
                Waypoint(position=(17, 29), direction=0),
                Waypoint(position=(17, 28), direction=3),
                Waypoint(position=(16, 28), direction=0),
                Waypoint(position=(15, 28), direction=0),
                Waypoint(position=(14, 28), direction=0),
                Waypoint(position=(13, 28), direction=0),
                Waypoint(position=(13, 29), direction=1),
                Waypoint(position=(12, 29), direction=0),
                Waypoint(position=(11, 29), direction=0),
                Waypoint(position=(10, 29), direction=0),
                Waypoint(position=(9, 29), direction=0),
                Waypoint(position=(8, 29), direction=0),
                Waypoint(position=(8, 28), direction=3),
                Waypoint(position=(8, 27), direction=3),
                Waypoint(position=(8, 26), direction=3),
                Waypoint(position=(7, 26), direction=0),
                Waypoint(position=(7, 25), direction=3),
                Waypoint(position=(7, 24), direction=3),
                Waypoint(position=(7, 23), direction=3)),
            (
                Waypoint(position=(23, 23), direction=1),
                Waypoint(position=(23, 24), direction=1),
                Waypoint(position=(23, 25), direction=1),
                Waypoint(position=(23, 26), direction=1),
                Waypoint(position=(24, 26), direction=2),
                Waypoint(position=(24, 27), direction=1),
                Waypoint(position=(23, 27), direction=0),
                Waypoint(position=(23, 28), direction=1),
                Waypoint(position=(23, 29), direction=1),
                Waypoint(position=(22, 29), direction=0),
                Waypoint(position=(21, 29), direction=0),
                Waypoint(position=(20, 29), direction=0),
                Waypoint(position=(19, 29), direction=0),
                Waypoint(position=(18, 29), direction=0),
                Waypoint(position=(17, 29), direction=0),
                Waypoint(position=(16, 29), direction=0),
                Waypoint(position=(15, 29), direction=0),
                Waypoint(position=(14, 29), direction=0),
                Waypoint(position=(13, 29), direction=0),
                Waypoint(position=(12, 29), direction=0),
                Waypoint(position=(11, 29), direction=0),
                Waypoint(position=(10, 29), direction=0),
                Waypoint(position=(9, 29), direction=0),
                Waypoint(position=(8, 29), direction=0),
                Waypoint(position=(7, 29), direction=0),
                Waypoint(position=(7, 28), direction=3),
                Waypoint(position=(7, 27), direction=3),
                Waypoint(position=(7, 26), direction=3),
                Waypoint(position=(7, 25), direction=3),
                Waypoint(position=(7, 24), direction=3),
                Waypoint(position=(7, 23), direction=3)),
            (
                Waypoint(position=(23, 23), direction=1),
                Waypoint(position=(23, 24), direction=1),
                Waypoint(position=(23, 25), direction=1),
                Waypoint(position=(23, 26), direction=1),
                Waypoint(position=(24, 26), direction=2),
                Waypoint(position=(24, 27), direction=1),
                Waypoint(position=(23, 27), direction=0),
                Waypoint(position=(23, 28), direction=1),
                Waypoint(position=(23, 29), direction=1),
                Waypoint(position=(22, 29), direction=0),
                Waypoint(position=(21, 29), direction=0),
                Waypoint(position=(20, 29), direction=0),
                Waypoint(position=(19, 29), direction=0),
                Waypoint(position=(18, 29), direction=0),
                Waypoint(position=(17, 29), direction=0),
                Waypoint(position=(16, 29), direction=0),
                Waypoint(position=(15, 29), direction=0),
                Waypoint(position=(14, 29), direction=0),
                Waypoint(position=(13, 29), direction=0),
                Waypoint(position=(12, 29), direction=0),
                Waypoint(position=(11, 29), direction=0),
                Waypoint(position=(10, 29), direction=0),
                Waypoint(position=(9, 29), direction=0),
                Waypoint(position=(8, 29), direction=0),
                Waypoint(position=(8, 28), direction=3),
                Waypoint(position=(8, 27), direction=3),
                Waypoint(position=(8, 26), direction=3),
                Waypoint(position=(7, 26), direction=0),
                Waypoint(position=(7, 25), direction=3),
                Waypoint(position=(7, 24), direction=3),
                Waypoint(position=(7, 23), direction=3)),
            (
                Waypoint(position=(23, 23), direction=1),
                Waypoint(position=(23, 24), direction=1),
                Waypoint(position=(23, 25), direction=1),
                Waypoint(position=(23, 26), direction=1),
                Waypoint(position=(24, 26), direction=2),
                Waypoint(position=(24, 27), direction=1),
                Waypoint(position=(24, 28), direction=1),
                Waypoint(position=(24, 29), direction=1),
                Waypoint(position=(23, 29), direction=0),
                Waypoint(position=(22, 29), direction=0),
                Waypoint(position=(21, 29), direction=0),
                Waypoint(position=(20, 29), direction=0),
                Waypoint(position=(19, 29), direction=0),
                Waypoint(position=(18, 29), direction=0),
                Waypoint(position=(17, 29), direction=0),
                Waypoint(position=(16, 29), direction=0),
                Waypoint(position=(15, 29), direction=0),
                Waypoint(position=(14, 29), direction=0),
                Waypoint(position=(13, 29), direction=0),
                Waypoint(position=(12, 29), direction=0),
                Waypoint(position=(11, 29), direction=0),
                Waypoint(position=(10, 29), direction=0),
                Waypoint(position=(9, 29), direction=0),
                Waypoint(position=(8, 29), direction=0),
                Waypoint(position=(7, 29), direction=0),
                Waypoint(position=(7, 28), direction=3),
                Waypoint(position=(7, 27), direction=3),
                Waypoint(position=(7, 26), direction=3),
                Waypoint(position=(7, 25), direction=3),
                Waypoint(position=(7, 24), direction=3),
                Waypoint(position=(7, 23), direction=3)),
            (
                Waypoint(position=(23, 23), direction=1),
                Waypoint(position=(23, 24), direction=1),
                Waypoint(position=(23, 25), direction=1),
                Waypoint(position=(23, 26), direction=1),
                Waypoint(position=(24, 26), direction=2),
                Waypoint(position=(24, 27), direction=1),
                Waypoint(position=(24, 28), direction=1),
                Waypoint(position=(24, 29), direction=1),
                Waypoint(position=(23, 29), direction=0),
                Waypoint(position=(22, 29), direction=0),
                Waypoint(position=(21, 29), direction=0),
                Waypoint(position=(20, 29), direction=0),
                Waypoint(position=(19, 29), direction=0),
                Waypoint(position=(18, 29), direction=0),
                Waypoint(position=(17, 29), direction=0),
                Waypoint(position=(16, 29), direction=0),
                Waypoint(position=(15, 29), direction=0),
                Waypoint(position=(14, 29), direction=0),
                Waypoint(position=(13, 29), direction=0),
                Waypoint(position=(12, 29), direction=0),
                Waypoint(position=(11, 29), direction=0),
                Waypoint(position=(10, 29), direction=0),
                Waypoint(position=(9, 29), direction=0),
                Waypoint(position=(8, 29), direction=0),
                Waypoint(position=(8, 28), direction=3),
                Waypoint(position=(8, 27), direction=3),
                Waypoint(position=(8, 26), direction=3),
                Waypoint(position=(7, 26), direction=0),
                Waypoint(position=(7, 25), direction=3),
                Waypoint(position=(7, 24), direction=3),
                Waypoint(position=(7, 23), direction=3)),
            (
                Waypoint(position=(23, 23), direction=1),
                Waypoint(position=(23, 24), direction=1),
                Waypoint(position=(23, 25), direction=1),
                Waypoint(position=(23, 26), direction=1),
                Waypoint(position=(23, 27), direction=1),
                Waypoint(position=(23, 28), direction=1),
                Waypoint(position=(23, 29), direction=1),
                Waypoint(position=(22, 29), direction=0),
                Waypoint(position=(21, 29), direction=0),
                Waypoint(position=(20, 29), direction=0),
                Waypoint(position=(19, 29), direction=0),
                Waypoint(position=(18, 29), direction=0),
                Waypoint(position=(17, 29), direction=0),
                Waypoint(position=(17, 28), direction=3),
                Waypoint(position=(16, 28), direction=0),
                Waypoint(position=(15, 28), direction=0),
                Waypoint(position=(14, 28), direction=0),
                Waypoint(position=(13, 28), direction=0),
                Waypoint(position=(13, 29), direction=1),
                Waypoint(position=(12, 29), direction=0),
                Waypoint(position=(11, 29), direction=0),
                Waypoint(position=(10, 29), direction=0),
                Waypoint(position=(9, 29), direction=0),
                Waypoint(position=(8, 29), direction=0),
                Waypoint(position=(7, 29), direction=0),
                Waypoint(position=(7, 28), direction=3),
                Waypoint(position=(7, 27), direction=3),
                Waypoint(position=(8, 27), direction=2),
                Waypoint(position=(8, 26), direction=3),
                Waypoint(position=(7, 26), direction=0),
                Waypoint(position=(7, 25), direction=3),
                Waypoint(position=(7, 24), direction=3),
                Waypoint(position=(7, 23), direction=3))]}
    schedule_trainruns = {0: [TrainrunWaypoint(scheduled_at=27, waypoint=Waypoint(position=(8, 23), direction=1)),
                              TrainrunWaypoint(scheduled_at=29, waypoint=Waypoint(position=(8, 24), direction=1)),
                              TrainrunWaypoint(scheduled_at=30, waypoint=Waypoint(position=(8, 25), direction=1)),
                              TrainrunWaypoint(scheduled_at=31, waypoint=Waypoint(position=(8, 26), direction=1)),
                              TrainrunWaypoint(scheduled_at=32, waypoint=Waypoint(position=(8, 27), direction=1)),
                              TrainrunWaypoint(scheduled_at=33, waypoint=Waypoint(position=(8, 28), direction=1)),
                              TrainrunWaypoint(scheduled_at=34, waypoint=Waypoint(position=(8, 29), direction=1)),
                              TrainrunWaypoint(scheduled_at=35, waypoint=Waypoint(position=(9, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=36, waypoint=Waypoint(position=(10, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=37, waypoint=Waypoint(position=(11, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=38, waypoint=Waypoint(position=(12, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=39, waypoint=Waypoint(position=(13, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=40, waypoint=Waypoint(position=(14, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=41, waypoint=Waypoint(position=(15, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=42, waypoint=Waypoint(position=(16, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=43, waypoint=Waypoint(position=(17, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=44, waypoint=Waypoint(position=(18, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=45, waypoint=Waypoint(position=(19, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=46, waypoint=Waypoint(position=(20, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=47, waypoint=Waypoint(position=(21, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=48, waypoint=Waypoint(position=(22, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=49, waypoint=Waypoint(position=(23, 29), direction=2)),
                              TrainrunWaypoint(scheduled_at=50, waypoint=Waypoint(position=(23, 28), direction=3)),
                              TrainrunWaypoint(scheduled_at=51, waypoint=Waypoint(position=(23, 27), direction=3)),
                              TrainrunWaypoint(scheduled_at=52, waypoint=Waypoint(position=(24, 27), direction=2)),
                              TrainrunWaypoint(scheduled_at=53, waypoint=Waypoint(position=(24, 26), direction=3)),
                              TrainrunWaypoint(scheduled_at=54, waypoint=Waypoint(position=(24, 25), direction=3)),
                              TrainrunWaypoint(scheduled_at=55, waypoint=Waypoint(position=(24, 24), direction=3)),
                              TrainrunWaypoint(scheduled_at=56, waypoint=Waypoint(position=(24, 23), direction=3))],
                          1: [TrainrunWaypoint(scheduled_at=4, waypoint=Waypoint(position=(23, 23), direction=1)),
                              TrainrunWaypoint(scheduled_at=6, waypoint=Waypoint(position=(23, 24), direction=1)),
                              TrainrunWaypoint(scheduled_at=7, waypoint=Waypoint(position=(23, 25), direction=1)),
                              TrainrunWaypoint(scheduled_at=8, waypoint=Waypoint(position=(23, 26), direction=1)),
                              TrainrunWaypoint(scheduled_at=9, waypoint=Waypoint(position=(23, 27), direction=1)),
                              TrainrunWaypoint(scheduled_at=10, waypoint=Waypoint(position=(23, 28), direction=1)),
                              TrainrunWaypoint(scheduled_at=11, waypoint=Waypoint(position=(23, 29), direction=1)),
                              TrainrunWaypoint(scheduled_at=12, waypoint=Waypoint(position=(22, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=13, waypoint=Waypoint(position=(21, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=14, waypoint=Waypoint(position=(20, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=15, waypoint=Waypoint(position=(19, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=16, waypoint=Waypoint(position=(18, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=17, waypoint=Waypoint(position=(17, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=18, waypoint=Waypoint(position=(16, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=19, waypoint=Waypoint(position=(15, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=20, waypoint=Waypoint(position=(14, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=21, waypoint=Waypoint(position=(13, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=22, waypoint=Waypoint(position=(12, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=23, waypoint=Waypoint(position=(11, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=24, waypoint=Waypoint(position=(10, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=25, waypoint=Waypoint(position=(9, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=26, waypoint=Waypoint(position=(8, 29), direction=0)),
                              TrainrunWaypoint(scheduled_at=27, waypoint=Waypoint(position=(8, 28), direction=3)),
                              TrainrunWaypoint(scheduled_at=28, waypoint=Waypoint(position=(8, 27), direction=3)),
                              TrainrunWaypoint(scheduled_at=29, waypoint=Waypoint(position=(8, 26), direction=3)),
                              TrainrunWaypoint(scheduled_at=30, waypoint=Waypoint(position=(7, 26), direction=0)),
                              TrainrunWaypoint(scheduled_at=31, waypoint=Waypoint(position=(7, 25), direction=3)),
                              TrainrunWaypoint(scheduled_at=32, waypoint=Waypoint(position=(7, 24), direction=3)),
                              TrainrunWaypoint(scheduled_at=33, waypoint=Waypoint(position=(7, 23), direction=3))]}

    malfunction = ExperimentMalfunction(time_step=19, agent_id=1, malfunction_duration=20)

    expected_freeze_dict = {
        0: RouteDAGConstraints(
            # agent 0 can run earlier than in schedule!
            earliest=route_dag_constraints_dict_from_list_of_train_run_waypoint([
                TrainrunWaypoint(scheduled_at=27, waypoint=Waypoint(position=(8, 23), direction=1)),
                TrainrunWaypoint(scheduled_at=28, waypoint=Waypoint(position=(8, 24), direction=1)),
                TrainrunWaypoint(scheduled_at=29, waypoint=Waypoint(position=(8, 25), direction=1)),
                TrainrunWaypoint(scheduled_at=30, waypoint=Waypoint(position=(8, 26), direction=1)),
                TrainrunWaypoint(scheduled_at=31, waypoint=Waypoint(position=(8, 27), direction=1)),
                TrainrunWaypoint(scheduled_at=32, waypoint=Waypoint(position=(8, 28), direction=1)),
                TrainrunWaypoint(scheduled_at=33, waypoint=Waypoint(position=(8, 29), direction=1)),
                TrainrunWaypoint(scheduled_at=34, waypoint=Waypoint(position=(9, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=35, waypoint=Waypoint(position=(10, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=36, waypoint=Waypoint(position=(11, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=37, waypoint=Waypoint(position=(12, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=38, waypoint=Waypoint(position=(13, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=39, waypoint=Waypoint(position=(14, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=40, waypoint=Waypoint(position=(15, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=41, waypoint=Waypoint(position=(16, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=42, waypoint=Waypoint(position=(17, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=43, waypoint=Waypoint(position=(18, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=44, waypoint=Waypoint(position=(19, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=45, waypoint=Waypoint(position=(20, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=46, waypoint=Waypoint(position=(21, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=47, waypoint=Waypoint(position=(22, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=48, waypoint=Waypoint(position=(23, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=49, waypoint=Waypoint(position=(24, 29), direction=2)),
                TrainrunWaypoint(scheduled_at=50, waypoint=Waypoint(position=(24, 28), direction=3)),
                TrainrunWaypoint(scheduled_at=51, waypoint=Waypoint(position=(24, 27), direction=3)),
                TrainrunWaypoint(scheduled_at=52, waypoint=Waypoint(position=(24, 26), direction=3)),
                TrainrunWaypoint(scheduled_at=53, waypoint=Waypoint(position=(24, 25), direction=3)),
                TrainrunWaypoint(scheduled_at=54, waypoint=Waypoint(position=(24, 24), direction=3)),
                TrainrunWaypoint(scheduled_at=55, waypoint=Waypoint(position=(24, 23), direction=3)),

                TrainrunWaypoint(waypoint=Waypoint(position=(7, 28), direction=1), scheduled_at=33),
                TrainrunWaypoint(waypoint=Waypoint(position=(7, 27), direction=0), scheduled_at=32),
                TrainrunWaypoint(waypoint=Waypoint(position=(7, 29), direction=1), scheduled_at=34),
                TrainrunWaypoint(waypoint=Waypoint(position=(8, 29), direction=2), scheduled_at=35),

                TrainrunWaypoint(scheduled_at=49, waypoint=Waypoint(position=(23, 28), direction=3)),
                TrainrunWaypoint(scheduled_at=50, waypoint=Waypoint(position=(23, 27), direction=3)),
                TrainrunWaypoint(scheduled_at=51, waypoint=Waypoint(position=(24, 27), direction=2)),
                TrainrunWaypoint(scheduled_at=39, waypoint=Waypoint(position=(13, 28), direction=3)),
                TrainrunWaypoint(scheduled_at=40, waypoint=Waypoint(position=(14, 28), direction=2)),
                TrainrunWaypoint(scheduled_at=41, waypoint=Waypoint(position=(15, 28), direction=2)),
                TrainrunWaypoint(scheduled_at=42, waypoint=Waypoint(position=(16, 28), direction=2)),
                TrainrunWaypoint(scheduled_at=43, waypoint=Waypoint(position=(17, 28), direction=2)),
                TrainrunWaypoint(scheduled_at=44, waypoint=Waypoint(position=(17, 29), direction=1))]),
            latest=OrderedDict(
                [(Waypoint(position=(24, 23), direction=3), 332 + 1),
                 (Waypoint(position=(8, 23), direction=1), 305),
                 (Waypoint(position=(8, 24), direction=1), 306),
                 (Waypoint(position=(8, 25), direction=1), 307),
                 (Waypoint(position=(8, 26), direction=1), 308),
                 (Waypoint(position=(8, 27), direction=1), 309),
                 (Waypoint(position=(8, 28), direction=1), 310),
                 (Waypoint(position=(8, 29), direction=1), 311),
                 (Waypoint(position=(9, 29), direction=2), 312),
                 (Waypoint(position=(10, 29), direction=2), 313),
                 (Waypoint(position=(11, 29), direction=2), 314),
                 (Waypoint(position=(12, 29), direction=2), 315),
                 (Waypoint(position=(13, 29), direction=2), 316),

                 (Waypoint(position=(7, 27), direction=0), 308),
                 (Waypoint(position=(7, 28), direction=1), 309),
                 (Waypoint(position=(7, 29), direction=1), 310),
                 (Waypoint(position=(8, 29), direction=2), 311),

                 (Waypoint(position=(24, 24), direction=3), 331 + 1),
                 (Waypoint(position=(24, 25), direction=3), 330 + 1),
                 (Waypoint(position=(24, 26), direction=3), 329 + 1),
                 (Waypoint(position=(24, 27), direction=3), 328 + 1),
                 (Waypoint(position=(24, 27), direction=2), 328 + 1),
                 (Waypoint(position=(23, 27), direction=3), 327 + 1),
                 (Waypoint(position=(24, 28), direction=3), 327 + 1),
                 (Waypoint(position=(23, 28), direction=3), 326 + 1),
                 (Waypoint(position=(24, 29), direction=2), 326 + 1),
                 (Waypoint(position=(23, 29), direction=2), 325 + 1),
                 (Waypoint(position=(22, 29), direction=2), 324 + 1),
                 (Waypoint(position=(21, 29), direction=2), 323 + 1),
                 (Waypoint(position=(20, 29), direction=2), 322 + 1),
                 (Waypoint(position=(19, 29), direction=2), 321 + 1),
                 (Waypoint(position=(18, 29), direction=2), 320 + 1),
                 (Waypoint(position=(17, 29), direction=2), 319 + 1),
                 (Waypoint(position=(17, 29), direction=1), 319 + 1),
                 (Waypoint(position=(17, 28), direction=2), 318 + 1),
                 (Waypoint(position=(16, 29), direction=2), 318 + 1),
                 (Waypoint(position=(16, 28), direction=2), 317 + 1),
                 (Waypoint(position=(15, 29), direction=2), 317 + 1),
                 (Waypoint(position=(15, 28), direction=2), 316 + 1),
                 (Waypoint(position=(14, 29), direction=2), 316 + 1),
                 (Waypoint(position=(14, 28), direction=2), 315 + 1),
                 (Waypoint(position=(13, 28), direction=3), 314 + 1)]),
        ),
        1: RouteDAGConstraints(
            earliest=route_dag_constraints_dict_from_list_of_train_run_waypoint([
                TrainrunWaypoint(scheduled_at=4, waypoint=Waypoint(position=(23, 23), direction=1)),
                TrainrunWaypoint(scheduled_at=6, waypoint=Waypoint(position=(23, 24), direction=1)),
                TrainrunWaypoint(scheduled_at=7, waypoint=Waypoint(position=(23, 25), direction=1)),
                TrainrunWaypoint(scheduled_at=8, waypoint=Waypoint(position=(23, 26), direction=1)),
                TrainrunWaypoint(scheduled_at=9, waypoint=Waypoint(position=(23, 27), direction=1)),
                TrainrunWaypoint(scheduled_at=10, waypoint=Waypoint(position=(23, 28), direction=1)),
                TrainrunWaypoint(scheduled_at=11, waypoint=Waypoint(position=(23, 29), direction=1)),
                TrainrunWaypoint(scheduled_at=12, waypoint=Waypoint(position=(22, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=13, waypoint=Waypoint(position=(21, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=14, waypoint=Waypoint(position=(20, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=15, waypoint=Waypoint(position=(19, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=16, waypoint=Waypoint(position=(18, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=17, waypoint=Waypoint(position=(17, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=18, waypoint=Waypoint(position=(16, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=19, waypoint=Waypoint(position=(15, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=40, waypoint=Waypoint(position=(14, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=41, waypoint=Waypoint(position=(13, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=42, waypoint=Waypoint(position=(12, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=43, waypoint=Waypoint(position=(11, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=44, waypoint=Waypoint(position=(10, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=45, waypoint=Waypoint(position=(9, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=46, waypoint=Waypoint(position=(8, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=47, waypoint=Waypoint(position=(7, 29), direction=0)),
                TrainrunWaypoint(scheduled_at=48, waypoint=Waypoint(position=(7, 28), direction=3)),
                TrainrunWaypoint(scheduled_at=49, waypoint=Waypoint(position=(7, 27), direction=3)),
                TrainrunWaypoint(scheduled_at=50, waypoint=Waypoint(position=(7, 26), direction=3)),
                TrainrunWaypoint(scheduled_at=51, waypoint=Waypoint(position=(7, 25), direction=3)),
                TrainrunWaypoint(scheduled_at=52, waypoint=Waypoint(position=(7, 24), direction=3)),
                TrainrunWaypoint(scheduled_at=53, waypoint=Waypoint(position=(7, 23), direction=3)),
                TrainrunWaypoint(scheduled_at=47, waypoint=Waypoint(position=(8, 28), direction=3)),
                TrainrunWaypoint(scheduled_at=48, waypoint=Waypoint(position=(8, 27), direction=3)),
                TrainrunWaypoint(scheduled_at=49, waypoint=Waypoint(position=(8, 26), direction=3)),
                TrainrunWaypoint(scheduled_at=50, waypoint=Waypoint(position=(7, 26), direction=0)),
                TrainrunWaypoint(scheduled_at=50, waypoint=Waypoint(position=(8, 27), direction=2))
            ]),
            latest=OrderedDict(
                [(Waypoint(position=(7, 23), direction=3), 332 + 1),
                 (Waypoint(position=(23, 23), direction=1), 4),
                 (Waypoint(position=(23, 24), direction=1), 6),
                 (Waypoint(position=(23, 25), direction=1), 7),
                 (Waypoint(position=(23, 26), direction=1), 8),
                 (Waypoint(position=(23, 27), direction=1), 9),
                 (Waypoint(position=(23, 28), direction=1), 10),
                 (Waypoint(position=(23, 29), direction=1), 11),
                 (Waypoint(position=(22, 29), direction=0), 12),
                 (Waypoint(position=(21, 29), direction=0), 13),
                 (Waypoint(position=(20, 29), direction=0), 14),
                 (Waypoint(position=(19, 29), direction=0), 15),
                 (Waypoint(position=(18, 29), direction=0), 16),
                 (Waypoint(position=(17, 29), direction=0), 17),
                 (Waypoint(position=(16, 29), direction=0), 18),
                 (Waypoint(position=(15, 29), direction=0), 19),
                 (Waypoint(position=(7, 24), direction=3), 331 + 1),
                 (Waypoint(position=(7, 25), direction=3), 330 + 1),
                 (Waypoint(position=(7, 26), direction=3), 329 + 1),
                 (Waypoint(position=(7, 26), direction=0), 329 + 1),
                 (Waypoint(position=(8, 26), direction=3), 328 + 1),
                 (Waypoint(position=(7, 27), direction=3), 328 + 1),
                 (Waypoint(position=(8, 27), direction=3), 327 + 1),
                 (Waypoint(position=(8, 27), direction=2), 327 + 1),
                 (Waypoint(position=(7, 28), direction=3), 327 + 1),
                 (Waypoint(position=(8, 28), direction=3), 326 + 1),
                 (Waypoint(position=(7, 29), direction=0), 326 + 1),
                 (Waypoint(position=(8, 29), direction=0), 325 + 1),
                 (Waypoint(position=(9, 29), direction=0), 324 + 1),
                 (Waypoint(position=(10, 29), direction=0), 323 + 1),
                 (Waypoint(position=(11, 29), direction=0), 322 + 1),
                 (Waypoint(position=(12, 29), direction=0), 321 + 1),
                 (Waypoint(position=(13, 29), direction=0), 320 + 1),
                 (Waypoint(position=(14, 29), direction=0), 319 + 1)]),
        )}

    reschedule_problem_description: ScheduleProblemDescription = delta_zero_for_all_agents(
        schedule_trainruns=schedule_trainruns,
        minimum_travel_time_dict={0: 1, 1: 1},
        topo_dict_={agent_id: topo_from_agent_paths(agents_path_dict[agent_id])
                    for agent_id in agents_path_dict},
        malfunction=malfunction,
        latest_arrival=333,
        weight_lateness_seconds=1,
        weight_route_change=1
    )
    freeze_dict: RouteDAGConstraintsDict = reschedule_problem_description.route_dag_constraints_dict

    print("####freeze_dict")
    experiment_freeze_dict_pretty_print(freeze_dict)
    assert freeze_dict.keys() == expected_freeze_dict.keys()
    for agent_id in expected_freeze_dict:
        assert freeze_dict[agent_id].earliest == expected_freeze_dict[agent_id].earliest, \
            f"difference earliest for agent {agent_id}: \n" \
            f"expected {expected_freeze_dict[agent_id].earliest}, \n" \
            f"found {freeze_dict[agent_id].earliest}, \n" \
            f"not expected {set(freeze_dict[agent_id].earliest.items()).difference(set(expected_freeze_dict[agent_id].earliest.items()))} \n" \
            f"not found {set(expected_freeze_dict[agent_id].earliest.items()).difference(set(freeze_dict[agent_id].earliest.items()))} \n"
        assert dict(freeze_dict[agent_id].latest) == dict(expected_freeze_dict[agent_id].latest), \
            f"difference latest for agent {agent_id}: \n" \
            f"expected {expected_freeze_dict[agent_id].latest}, \n" \
            f"found {freeze_dict[agent_id].latest}\n" \
            f"not expected {set(expected_freeze_dict[agent_id].latest.items()).difference(freeze_dict[agent_id].latest.items())}, \n" \
            f"not found {set(freeze_dict[agent_id].latest.items()).difference(expected_freeze_dict[agent_id].latest.items())}\n"


def test_bugfix_sim_172():
    agent_paths = [(Waypoint(position=(25, 23), direction=1),
                    Waypoint(position=(25, 24), direction=1),
                    Waypoint(position=(25, 25), direction=1),
                    Waypoint(position=(24, 25), direction=0),
                    Waypoint(position=(24, 26), direction=1),
                    Waypoint(position=(24, 27), direction=1),
                    Waypoint(position=(23, 27), direction=0),
                    Waypoint(position=(23, 28), direction=1),
                    Waypoint(position=(23, 29), direction=1),
                    Waypoint(position=(22, 29), direction=0),
                    Waypoint(position=(21, 29), direction=0),
                    Waypoint(position=(20, 29), direction=0),
                    Waypoint(position=(19, 29), direction=0),
                    Waypoint(position=(18, 29), direction=0),
                    Waypoint(position=(17, 29), direction=0),
                    Waypoint(position=(16, 29), direction=0),
                    Waypoint(position=(15, 29), direction=0),
                    Waypoint(position=(14, 29), direction=0),
                    Waypoint(position=(13, 29), direction=0),
                    Waypoint(position=(12, 29), direction=0),
                    Waypoint(position=(11, 29), direction=0),
                    Waypoint(position=(10, 29), direction=0),
                    Waypoint(position=(9, 29), direction=0),
                    Waypoint(position=(8, 29), direction=0),
                    Waypoint(position=(8, 28), direction=3),
                    Waypoint(position=(8, 27), direction=3),
                    Waypoint(position=(8, 26), direction=3),
                    Waypoint(position=(8, 25), direction=3),
                    Waypoint(position=(9, 25), direction=2),
                    Waypoint(position=(9, 24), direction=3),
                    Waypoint(position=(9, 23), direction=3)),
                   (Waypoint(position=(25, 23), direction=1),
                    Waypoint(position=(25, 24), direction=1),
                    Waypoint(position=(25, 25), direction=1),
                    Waypoint(position=(24, 25), direction=0),
                    Waypoint(position=(24, 26), direction=1),
                    Waypoint(position=(24, 27), direction=1),
                    Waypoint(position=(24, 28), direction=1),
                    Waypoint(position=(24, 29), direction=1),
                    Waypoint(position=(23, 29), direction=0),
                    Waypoint(position=(22, 29), direction=0),
                    Waypoint(position=(21, 29), direction=0),
                    Waypoint(position=(20, 29), direction=0),
                    Waypoint(position=(19, 29), direction=0),
                    Waypoint(position=(18, 29), direction=0),
                    Waypoint(position=(17, 29), direction=0),
                    Waypoint(position=(16, 29), direction=0),
                    Waypoint(position=(15, 29), direction=0),
                    Waypoint(position=(14, 29), direction=0),
                    Waypoint(position=(13, 29), direction=0),
                    Waypoint(position=(12, 29), direction=0),
                    Waypoint(position=(11, 29), direction=0),
                    Waypoint(position=(10, 29), direction=0),
                    Waypoint(position=(9, 29), direction=0),
                    Waypoint(position=(8, 29), direction=0),
                    Waypoint(position=(8, 28), direction=3),
                    Waypoint(position=(8, 27), direction=3),
                    Waypoint(position=(8, 26), direction=3),
                    Waypoint(position=(8, 25), direction=3),
                    Waypoint(position=(9, 25), direction=2),
                    Waypoint(position=(9, 24), direction=3),
                    Waypoint(position=(9, 23), direction=3)),
                   (Waypoint(position=(25, 23), direction=1),
                    Waypoint(position=(25, 24), direction=1),
                    Waypoint(position=(25, 25), direction=1),
                    Waypoint(position=(24, 25), direction=0),
                    Waypoint(position=(24, 26), direction=1),
                    Waypoint(position=(24, 27), direction=1),
                    Waypoint(position=(23, 27), direction=0),
                    Waypoint(position=(23, 28), direction=1),
                    Waypoint(position=(23, 29), direction=1),
                    Waypoint(position=(22, 29), direction=0),
                    Waypoint(position=(21, 29), direction=0),
                    Waypoint(position=(20, 29), direction=0),
                    Waypoint(position=(19, 29), direction=0),
                    Waypoint(position=(18, 29), direction=0),
                    Waypoint(position=(17, 29), direction=0),
                    Waypoint(position=(16, 29), direction=0),
                    Waypoint(position=(15, 29), direction=0),
                    Waypoint(position=(14, 29), direction=0),
                    Waypoint(position=(13, 29), direction=0),
                    Waypoint(position=(12, 29), direction=0),
                    Waypoint(position=(11, 29), direction=0),
                    Waypoint(position=(10, 29), direction=0),
                    Waypoint(position=(9, 29), direction=0),
                    Waypoint(position=(8, 29), direction=0),
                    Waypoint(position=(7, 29), direction=0),
                    Waypoint(position=(7, 28), direction=3),
                    Waypoint(position=(7, 27), direction=3),
                    Waypoint(position=(8, 27), direction=2),
                    Waypoint(position=(8, 26), direction=3),
                    Waypoint(position=(8, 25), direction=3),
                    Waypoint(position=(9, 25), direction=2),
                    Waypoint(position=(9, 24), direction=3),
                    Waypoint(position=(9, 23), direction=3)),
                   (Waypoint(position=(25, 23), direction=1),
                    Waypoint(position=(25, 24), direction=1),
                    Waypoint(position=(25, 25), direction=1),
                    Waypoint(position=(24, 25), direction=0),
                    Waypoint(position=(24, 26), direction=1),
                    Waypoint(position=(24, 27), direction=1),
                    Waypoint(position=(23, 27), direction=0),
                    Waypoint(position=(23, 28), direction=1),
                    Waypoint(position=(23, 29), direction=1),
                    Waypoint(position=(22, 29), direction=0),
                    Waypoint(position=(21, 29), direction=0),
                    Waypoint(position=(20, 29), direction=0),
                    Waypoint(position=(19, 29), direction=0),
                    Waypoint(position=(18, 29), direction=0),
                    Waypoint(position=(17, 29), direction=0),
                    Waypoint(position=(17, 28), direction=3),
                    Waypoint(position=(16, 28), direction=0),
                    Waypoint(position=(15, 28), direction=0),
                    Waypoint(position=(14, 28), direction=0),
                    Waypoint(position=(13, 28), direction=0),
                    Waypoint(position=(13, 29), direction=1),
                    Waypoint(position=(12, 29), direction=0),
                    Waypoint(position=(11, 29), direction=0),
                    Waypoint(position=(10, 29), direction=0),
                    Waypoint(position=(9, 29), direction=0),
                    Waypoint(position=(8, 29), direction=0),
                    Waypoint(position=(8, 28), direction=3),
                    Waypoint(position=(8, 27), direction=3),
                    Waypoint(position=(8, 26), direction=3),
                    Waypoint(position=(8, 25), direction=3),
                    Waypoint(position=(9, 25), direction=2),
                    Waypoint(position=(9, 24), direction=3),
                    Waypoint(position=(9, 23), direction=3)),
                   (Waypoint(position=(25, 23), direction=1),
                    Waypoint(position=(25, 24), direction=1),
                    Waypoint(position=(25, 25), direction=1),
                    Waypoint(position=(24, 25), direction=0),
                    Waypoint(position=(24, 26), direction=1),
                    Waypoint(position=(24, 27), direction=1),
                    Waypoint(position=(24, 28), direction=1),
                    Waypoint(position=(24, 29), direction=1),
                    Waypoint(position=(23, 29), direction=0),
                    Waypoint(position=(22, 29), direction=0),
                    Waypoint(position=(21, 29), direction=0),
                    Waypoint(position=(20, 29), direction=0),
                    Waypoint(position=(19, 29), direction=0),
                    Waypoint(position=(18, 29), direction=0),
                    Waypoint(position=(17, 29), direction=0),
                    Waypoint(position=(16, 29), direction=0),
                    Waypoint(position=(15, 29), direction=0),
                    Waypoint(position=(14, 29), direction=0),
                    Waypoint(position=(13, 29), direction=0),
                    Waypoint(position=(12, 29), direction=0),
                    Waypoint(position=(11, 29), direction=0),
                    Waypoint(position=(10, 29), direction=0),
                    Waypoint(position=(9, 29), direction=0),
                    Waypoint(position=(8, 29), direction=0),
                    Waypoint(position=(7, 29), direction=0),
                    Waypoint(position=(7, 28), direction=3),
                    Waypoint(position=(7, 27), direction=3),
                    Waypoint(position=(8, 27), direction=2),
                    Waypoint(position=(8, 26), direction=3),
                    Waypoint(position=(8, 25), direction=3),
                    Waypoint(position=(9, 25), direction=2),
                    Waypoint(position=(9, 24), direction=3),
                    Waypoint(position=(9, 23), direction=3)),
                   (Waypoint(position=(25, 23), direction=1),
                    Waypoint(position=(25, 24), direction=1),
                    Waypoint(position=(25, 25), direction=1),
                    Waypoint(position=(24, 25), direction=0),
                    Waypoint(position=(24, 26), direction=1),
                    Waypoint(position=(24, 27), direction=1),
                    Waypoint(position=(24, 28), direction=1),
                    Waypoint(position=(24, 29), direction=1),
                    Waypoint(position=(23, 29), direction=0),
                    Waypoint(position=(22, 29), direction=0),
                    Waypoint(position=(21, 29), direction=0),
                    Waypoint(position=(20, 29), direction=0),
                    Waypoint(position=(19, 29), direction=0),
                    Waypoint(position=(18, 29), direction=0),
                    Waypoint(position=(17, 29), direction=0),
                    Waypoint(position=(17, 28), direction=3),
                    Waypoint(position=(16, 28), direction=0),
                    Waypoint(position=(15, 28), direction=0),
                    Waypoint(position=(14, 28), direction=0),
                    Waypoint(position=(13, 28), direction=0),
                    Waypoint(position=(13, 29), direction=1),
                    Waypoint(position=(12, 29), direction=0),
                    Waypoint(position=(11, 29), direction=0),
                    Waypoint(position=(10, 29), direction=0),
                    Waypoint(position=(9, 29), direction=0),
                    Waypoint(position=(8, 29), direction=0),
                    Waypoint(position=(8, 28), direction=3),
                    Waypoint(position=(8, 27), direction=3),
                    Waypoint(position=(8, 26), direction=3),
                    Waypoint(position=(8, 25), direction=3),
                    Waypoint(position=(9, 25), direction=2),
                    Waypoint(position=(9, 24), direction=3),
                    Waypoint(position=(9, 23), direction=3)),
                   (Waypoint(position=(25, 23), direction=1),
                    Waypoint(position=(25, 24), direction=1),
                    Waypoint(position=(25, 25), direction=1),
                    Waypoint(position=(24, 25), direction=0),
                    Waypoint(position=(24, 26), direction=1),
                    Waypoint(position=(24, 27), direction=1),
                    Waypoint(position=(23, 27), direction=0),
                    Waypoint(position=(23, 28), direction=1),
                    Waypoint(position=(23, 29), direction=1),
                    Waypoint(position=(22, 29), direction=0),
                    Waypoint(position=(21, 29), direction=0),
                    Waypoint(position=(20, 29), direction=0),
                    Waypoint(position=(19, 29), direction=0),
                    Waypoint(position=(18, 29), direction=0),
                    Waypoint(position=(17, 29), direction=0),
                    Waypoint(position=(17, 28), direction=3),
                    Waypoint(position=(16, 28), direction=0),
                    Waypoint(position=(15, 28), direction=0),
                    Waypoint(position=(14, 28), direction=0),
                    Waypoint(position=(13, 28), direction=0),
                    Waypoint(position=(13, 29), direction=1),
                    Waypoint(position=(12, 29), direction=0),
                    Waypoint(position=(11, 29), direction=0),
                    Waypoint(position=(10, 29), direction=0),
                    Waypoint(position=(9, 29), direction=0),
                    Waypoint(position=(8, 29), direction=0),
                    Waypoint(position=(7, 29), direction=0),
                    Waypoint(position=(7, 28), direction=3),
                    Waypoint(position=(7, 27), direction=3),
                    Waypoint(position=(8, 27), direction=2),
                    Waypoint(position=(8, 26), direction=3),
                    Waypoint(position=(8, 25), direction=3),
                    Waypoint(position=(9, 25), direction=2),
                    Waypoint(position=(9, 24), direction=3),
                    Waypoint(position=(9, 23), direction=3)),
                   (Waypoint(position=(25, 23), direction=1),
                    Waypoint(position=(25, 24), direction=1),
                    Waypoint(position=(25, 25), direction=1),
                    Waypoint(position=(24, 25), direction=0),
                    Waypoint(position=(24, 26), direction=1),
                    Waypoint(position=(24, 27), direction=1),
                    Waypoint(position=(24, 28), direction=1),
                    Waypoint(position=(24, 29), direction=1),
                    Waypoint(position=(23, 29), direction=0),
                    Waypoint(position=(22, 29), direction=0),
                    Waypoint(position=(21, 29), direction=0),
                    Waypoint(position=(20, 29), direction=0),
                    Waypoint(position=(19, 29), direction=0),
                    Waypoint(position=(18, 29), direction=0),
                    Waypoint(position=(17, 29), direction=0),
                    Waypoint(position=(17, 28), direction=3),
                    Waypoint(position=(16, 28), direction=0),
                    Waypoint(position=(15, 28), direction=0),
                    Waypoint(position=(14, 28), direction=0),
                    Waypoint(position=(13, 28), direction=0),
                    Waypoint(position=(13, 29), direction=1),
                    Waypoint(position=(12, 29), direction=0),
                    Waypoint(position=(11, 29), direction=0),
                    Waypoint(position=(10, 29), direction=0),
                    Waypoint(position=(9, 29), direction=0),
                    Waypoint(position=(8, 29), direction=0),
                    Waypoint(position=(7, 29), direction=0),
                    Waypoint(position=(7, 28), direction=3),
                    Waypoint(position=(7, 27), direction=3),
                    Waypoint(position=(8, 27), direction=2),
                    Waypoint(position=(8, 26), direction=3),
                    Waypoint(position=(8, 25), direction=3),
                    Waypoint(position=(9, 25), direction=2),
                    Waypoint(position=(9, 24), direction=3),
                    Waypoint(position=(9, 23), direction=3))]
    schedule_trainrun = [TrainrunWaypoint(scheduled_at=4, waypoint=Waypoint(position=(25, 23), direction=1)),
                         TrainrunWaypoint(scheduled_at=6, waypoint=Waypoint(position=(25, 24), direction=1)),
                         TrainrunWaypoint(scheduled_at=7, waypoint=Waypoint(position=(25, 25), direction=1)),
                         TrainrunWaypoint(scheduled_at=8, waypoint=Waypoint(position=(24, 25), direction=0)),
                         TrainrunWaypoint(scheduled_at=9, waypoint=Waypoint(position=(24, 26), direction=1)),
                         TrainrunWaypoint(scheduled_at=10, waypoint=Waypoint(position=(24, 27), direction=1)),
                         TrainrunWaypoint(scheduled_at=11, waypoint=Waypoint(position=(24, 28), direction=1)),
                         TrainrunWaypoint(scheduled_at=12, waypoint=Waypoint(position=(24, 29), direction=1)),
                         TrainrunWaypoint(scheduled_at=13, waypoint=Waypoint(position=(23, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=14, waypoint=Waypoint(position=(22, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=15, waypoint=Waypoint(position=(21, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=16, waypoint=Waypoint(position=(20, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=17, waypoint=Waypoint(position=(19, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=18, waypoint=Waypoint(position=(18, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=19, waypoint=Waypoint(position=(17, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=20, waypoint=Waypoint(position=(16, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=21, waypoint=Waypoint(position=(15, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=22, waypoint=Waypoint(position=(14, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=23, waypoint=Waypoint(position=(13, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=24, waypoint=Waypoint(position=(12, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=25, waypoint=Waypoint(position=(11, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=26, waypoint=Waypoint(position=(10, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=27, waypoint=Waypoint(position=(9, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=28, waypoint=Waypoint(position=(8, 29), direction=0)),
                         TrainrunWaypoint(scheduled_at=29, waypoint=Waypoint(position=(8, 28), direction=3)),
                         TrainrunWaypoint(scheduled_at=30, waypoint=Waypoint(position=(8, 27), direction=3)),
                         TrainrunWaypoint(scheduled_at=31, waypoint=Waypoint(position=(8, 26), direction=3)),
                         TrainrunWaypoint(scheduled_at=32, waypoint=Waypoint(position=(8, 25), direction=3)),
                         TrainrunWaypoint(scheduled_at=33, waypoint=Waypoint(position=(9, 25), direction=2)),
                         TrainrunWaypoint(scheduled_at=34, waypoint=Waypoint(position=(9, 24), direction=3)),
                         TrainrunWaypoint(scheduled_at=35, waypoint=Waypoint(position=(9, 23), direction=3))]
    malfunction = ExperimentMalfunction(time_step=19, agent_id=4, malfunction_duration=20)

    actual_route_dag_constraints = scoper_zero_running(
        agent_id=malfunction.agent_id,
        schedule_trainrun=schedule_trainrun,
        malfunction=malfunction,
        minimum_travel_time=1,
        topo=topo_from_agent_paths(agent_paths),
        latest_arrival=6667)

    experiment_freeze_pretty_print(actual_route_dag_constraints)

    expected_latest = route_dag_constraints_dict_from_list_of_train_run_waypoint(
        [TrainrunWaypoint(waypoint=Waypoint(position=(9, 23), direction=3), scheduled_at=6666 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(25, 23), direction=1), scheduled_at=4),
         TrainrunWaypoint(waypoint=Waypoint(position=(25, 24), direction=1), scheduled_at=6),
         TrainrunWaypoint(waypoint=Waypoint(position=(25, 25), direction=1), scheduled_at=7),
         TrainrunWaypoint(waypoint=Waypoint(position=(24, 25), direction=0), scheduled_at=8),
         TrainrunWaypoint(waypoint=Waypoint(position=(24, 26), direction=1), scheduled_at=9),
         TrainrunWaypoint(waypoint=Waypoint(position=(24, 27), direction=1), scheduled_at=10),
         TrainrunWaypoint(waypoint=Waypoint(position=(24, 28), direction=1), scheduled_at=11),
         TrainrunWaypoint(waypoint=Waypoint(position=(24, 29), direction=1), scheduled_at=12),
         TrainrunWaypoint(waypoint=Waypoint(position=(23, 29), direction=0), scheduled_at=13),
         TrainrunWaypoint(waypoint=Waypoint(position=(22, 29), direction=0), scheduled_at=14),
         TrainrunWaypoint(waypoint=Waypoint(position=(21, 29), direction=0), scheduled_at=15),
         TrainrunWaypoint(waypoint=Waypoint(position=(20, 29), direction=0), scheduled_at=16),
         TrainrunWaypoint(waypoint=Waypoint(position=(19, 29), direction=0), scheduled_at=17),
         TrainrunWaypoint(waypoint=Waypoint(position=(18, 29), direction=0), scheduled_at=18),
         TrainrunWaypoint(waypoint=Waypoint(position=(17, 29), direction=0), scheduled_at=19),

         TrainrunWaypoint(waypoint=Waypoint(position=(9, 24), direction=3), scheduled_at=6665 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(9, 25), direction=2), scheduled_at=6664 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(8, 25), direction=3), scheduled_at=6663 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(8, 26), direction=3), scheduled_at=6662 + 1),

         # shorter alternative for which it suffices to enter later than the longer!
         TrainrunWaypoint(waypoint=Waypoint(position=(8, 27), direction=3), scheduled_at=6661 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(8, 28), direction=3), scheduled_at=6660 + 1),

         # longer alternative for which must be earlier to use at!
         TrainrunWaypoint(waypoint=Waypoint(position=(8, 27), direction=2), scheduled_at=6661 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(7, 27), direction=3), scheduled_at=6660 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(7, 28), direction=3), scheduled_at=6659 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(7, 29), direction=0), scheduled_at=6658 + 1),

         TrainrunWaypoint(waypoint=Waypoint(position=(8, 29), direction=0), scheduled_at=6659 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(9, 29), direction=0), scheduled_at=6658 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(10, 29), direction=0), scheduled_at=6657 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(11, 29), direction=0), scheduled_at=6656 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(12, 29), direction=0), scheduled_at=6655 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(13, 29), direction=0), scheduled_at=6654 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(14, 29), direction=0), scheduled_at=6653 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(15, 29), direction=0), scheduled_at=6652 + 1),
         TrainrunWaypoint(waypoint=Waypoint(position=(16, 29), direction=0), scheduled_at=6651 + 1),
         ])
    experiment_freeze_pretty_print(actual_route_dag_constraints)
    actual_dict = actual_route_dag_constraints.latest
    expected_dict = expected_latest
    compare_dicts(actual_dict, expected_dict)

    expected_earliest = route_dag_constraints_dict_from_list_of_train_run_waypoint(
        [TrainrunWaypoint(scheduled_at=4, waypoint=Waypoint(position=(25, 23), direction=1)),
         TrainrunWaypoint(scheduled_at=6, waypoint=Waypoint(position=(25, 24), direction=1)),
         TrainrunWaypoint(scheduled_at=7, waypoint=Waypoint(position=(25, 25), direction=1)),
         TrainrunWaypoint(scheduled_at=8, waypoint=Waypoint(position=(24, 25), direction=0)),
         TrainrunWaypoint(scheduled_at=9, waypoint=Waypoint(position=(24, 26), direction=1)),
         TrainrunWaypoint(scheduled_at=10, waypoint=Waypoint(position=(24, 27), direction=1)),
         TrainrunWaypoint(scheduled_at=11, waypoint=Waypoint(position=(24, 28), direction=1)),
         TrainrunWaypoint(scheduled_at=12, waypoint=Waypoint(position=(24, 29), direction=1)),
         TrainrunWaypoint(scheduled_at=13, waypoint=Waypoint(position=(23, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=14, waypoint=Waypoint(position=(22, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=15, waypoint=Waypoint(position=(21, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=16, waypoint=Waypoint(position=(20, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=17, waypoint=Waypoint(position=(19, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=18, waypoint=Waypoint(position=(18, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=19, waypoint=Waypoint(position=(17, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=40, waypoint=Waypoint(position=(16, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=41, waypoint=Waypoint(position=(15, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=42, waypoint=Waypoint(position=(14, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=43, waypoint=Waypoint(position=(13, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=44, waypoint=Waypoint(position=(12, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=45, waypoint=Waypoint(position=(11, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=46, waypoint=Waypoint(position=(10, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=47, waypoint=Waypoint(position=(9, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=48, waypoint=Waypoint(position=(8, 29), direction=0)),

         TrainrunWaypoint(scheduled_at=49, waypoint=Waypoint(position=(8, 28), direction=3)),
         TrainrunWaypoint(scheduled_at=50, waypoint=Waypoint(position=(8, 27), direction=3)),

         TrainrunWaypoint(scheduled_at=49, waypoint=Waypoint(position=(7, 29), direction=0)),
         TrainrunWaypoint(scheduled_at=50, waypoint=Waypoint(position=(7, 28), direction=3)),
         TrainrunWaypoint(scheduled_at=51, waypoint=Waypoint(position=(7, 27), direction=3)),
         TrainrunWaypoint(scheduled_at=52, waypoint=Waypoint(position=(8, 27), direction=2)),

         TrainrunWaypoint(scheduled_at=51, waypoint=Waypoint(position=(8, 26), direction=3)),
         TrainrunWaypoint(scheduled_at=52, waypoint=Waypoint(position=(8, 25), direction=3)),
         TrainrunWaypoint(scheduled_at=53, waypoint=Waypoint(position=(9, 25), direction=2)),
         TrainrunWaypoint(scheduled_at=54, waypoint=Waypoint(position=(9, 24), direction=3)),
         TrainrunWaypoint(scheduled_at=55, waypoint=Waypoint(position=(9, 23), direction=3)),
         ])
    compare_dicts(actual_route_dag_constraints.earliest, expected_earliest)


def test_bugfix_sim_175_no_path_splitting_forward():
    """No path splitting forward.

    When the vertices marked by F are freezed, those marked by X must be removed!
    F(1,0)
       |
    F(2,0) - F(2,1)
       |       |
    X(3,0)   (3,1)
       |       |
    X(4,0) - (4,1)
    """

    # N.B. the directions do not matter for this test!
    agent_paths = [(Waypoint(position=(1, 0), direction=0),
                    Waypoint(position=(2, 0), direction=0),
                    Waypoint(position=(2, 1), direction=0),
                    Waypoint(position=(3, 1), direction=0),
                    Waypoint(position=(4, 1), direction=0)),

                   (Waypoint(position=(1, 0), direction=0),
                    Waypoint(position=(2, 0), direction=0),
                    Waypoint(position=(3, 0), direction=0),
                    Waypoint(position=(4, 0), direction=0),
                    Waypoint(position=(4, 1), direction=0)),

                   ]
    force_freeze = [TrainrunWaypoint(scheduled_at=0, waypoint=Waypoint(position=(1, 0), direction=0)),
                    TrainrunWaypoint(scheduled_at=2, waypoint=Waypoint(position=(2, 0), direction=0)),
                    TrainrunWaypoint(scheduled_at=3, waypoint=Waypoint(position=(2, 1), direction=0)),
                    ]

    topo = topo_from_agent_paths(agent_paths)
    actual_route_dag_constraints = scoper_zero_running(
        agent_id=0,
        malfunction=ExperimentMalfunction(agent_id=1, time_step=55, malfunction_duration=55),
        schedule_trainrun=force_freeze,
        minimum_travel_time=1,
        topo=topo,
        latest_arrival=6667,

    )

    experiment_freeze_pretty_print(actual_route_dag_constraints)
    # (3,0) must be removed (forward) since the edge (2,0)->(3,1) is frozen and since (3,0) is a forward successor of (2,0)
    assert Waypoint(position=(3, 0), direction=0) not in topo.nodes

    # (4,0) must be removed since reachable forward only through (3,0)
    assert Waypoint(position=(4, 0), direction=0) not in topo.nodes


def test_bugfix_sim_175_no_path_splitting_backward():
    """No path splitting backward.
       When the vertices marked by F are freezed, those marked by X must be removed
        (1,0)
          |
        (2,0) -  (2,1)
          |       |
       X(3,0)   F(3,1)
          |       |
       X(4,0) - F(4,1)
    """

    # N.B. the directions do not matter for this test!
    agent_paths = [(Waypoint(position=(1, 0), direction=0),
                    Waypoint(position=(2, 0), direction=0),
                    Waypoint(position=(2, 1), direction=0),
                    Waypoint(position=(3, 1), direction=0),
                    Waypoint(position=(4, 1), direction=0)),

                   (Waypoint(position=(1, 0), direction=0),
                    Waypoint(position=(2, 0), direction=0),
                    Waypoint(position=(3, 0), direction=0),
                    Waypoint(position=(4, 0), direction=0),
                    Waypoint(position=(4, 1), direction=0)),

                   ]
    force_freeze = [
        TrainrunWaypoint(scheduled_at=3, waypoint=Waypoint(position=(3, 1), direction=0)),
        TrainrunWaypoint(scheduled_at=4, waypoint=Waypoint(position=(4, 1), direction=0)),
    ]

    topo = topo_from_agent_paths(agent_paths)
    actual_route_dag_constraints = scoper_zero_running(
        agent_id=0,
        malfunction=ExperimentMalfunction(time_step=4, agent_id=0, malfunction_duration=20),
        schedule_trainrun=force_freeze,
        minimum_travel_time=1,
        topo=topo,
        latest_arrival=6667)

    experiment_freeze_pretty_print(actual_route_dag_constraints)
    # (4,0) must be removed (backward) since the edge (3,1)->(4,1) is frozen and since (4,0) is a backward neighbor of (4,1)
    assert Waypoint(position=(3, 0), direction=0) not in topo.nodes

    # (3,0) must be removed since it cannot be reached backwards as (4,0) is removed.
    assert Waypoint(position=(3, 0), direction=0) not in topo.nodes


def test_bugfix_sim_175_no_path_splitting_notorious():
    """No path splitting backward.
       When the vertices marked by F are freezed, those marked by X must be removed!
        (1,0)
          |
        (2,0) -  (2,1)
          |       |
       X(3,0)   F (3,1)
          |       |
       X(4,0) -  (4,1)

      Here we cannot use any more banning neighbors of freezed vertices!
    """

    # N.B. the directions do not matter for this test!
    agent_paths = [(Waypoint(position=(1, 0), direction=0),
                    Waypoint(position=(2, 0), direction=0),
                    Waypoint(position=(2, 1), direction=0),
                    Waypoint(position=(3, 1), direction=0),
                    Waypoint(position=(4, 1), direction=0)),

                   (Waypoint(position=(1, 0), direction=0),
                    Waypoint(position=(2, 0), direction=0),
                    Waypoint(position=(3, 0), direction=0),
                    Waypoint(position=(4, 0), direction=0),
                    Waypoint(position=(4, 1), direction=0)),

                   ]
    force_freeze = [
        TrainrunWaypoint(scheduled_at=3, waypoint=Waypoint(position=(3, 1), direction=0)),
    ]

    topo = topo_from_agent_paths(agent_paths)
    actual_route_dag_constraints = scoper_zero_running(
        agent_id=0,
        malfunction=ExperimentMalfunction(agent_id=1, time_step=55, malfunction_duration=55),
        schedule_trainrun=force_freeze,
        minimum_travel_time=1,
        topo=topo,
        latest_arrival=6667)

    experiment_freeze_pretty_print(actual_route_dag_constraints)
    # (4,0) must be removed (backward) since the edge (3,1)->(4,1) is frozen and since (4,0) is a backward neighbor of (4,1)
    assert Waypoint(position=(3, 0), direction=0) not in topo.nodes

    # (3,0) must be removed since it cannot be reached backwards as (4,0) is removed.
    assert Waypoint(position=(3, 0), direction=0) not in topo.nodes


def compare_dicts(actual_dict: Dict[Any, Any], expected_dict: Dict[Any, Any]):
    assert set(actual_dict.keys()) == set(expected_dict.keys()), \
        f"not same keys: " + \
        f"only expected {set(expected_dict).difference(set(actual_dict))} \n" + \
        f"only actual {set(actual_dict).difference(set(expected_dict))}"
    for key in expected_dict:
        expected_val = expected_dict[key]
        actual_val = actual_dict[key]
        assert actual_val == expected_val, f"{key}, actual={actual_val}, expected={expected_val}"
